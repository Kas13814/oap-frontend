<!DOCTYPE html>
<html lang="en-GB" dir="ltr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Employee Delay</title>

<!-- Boot: Ø·Ø¨Ù‘Ù‚ Ø§Ù„Ø«ÙŠÙ… Ù…Ø¨ÙƒØ±Ø§Ù‹ ÙˆØªØ²Ø§Ù…Ù† Ù…Ø¹ Home.html (theme + sgs_theme fallback) -->
<script>
(function(){
  try{
    var KEY='theme', LEGACY='sgs_theme';
    function resolveSystem(){
      return (window.matchMedia && matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';
    }
    function applyTheme(v){
      var t = v || localStorage.getItem(KEY) || localStorage.getItem(LEGACY) || 'light';
      if (t === 'system') t = resolveSystem();
      document.documentElement.setAttribute('data-theme', t);
    }
    applyTheme(); // ØªØ·Ø¨ÙŠÙ‚ ÙÙˆØ±ÙŠ Ù‚Ø¨Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ CSS
    window.addEventListener('storage', function(e){
      if (e.key === KEY || e.key === LEGACY) applyTheme(e.newValue);
    });
  }catch(e){}
})();
</script>

<style>
:root{
  --bg:#F6F4F1; --card:#FAFAFA; --text:#0F1220; --muted:#6B7280;
  --brand:#22D3A6; --accent:#6D28D9; --ring:#E8E8E8;
  --shadow:0 10px 30px rgba(2,8,23,.12); --radius:22px;
}

/* === Dark theme (Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø·Ù„Ø¨ÙƒØŒ ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø§ ØªØ®ØªÙÙŠ) === */
[data-theme="dark"]{
  --bg:#0B0B0C;     /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø© */
  --card:#111213;   /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù„ÙˆØ­Ø© ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ */
  --text:#E5E7EB;
  --muted:#94A3B8;
  --brand:#22D3A6;
  --accent:#8B5CF6;
  --ring:#2A2B2C;   /* Ø­Ø¯ÙˆØ¯ Ø£ÙˆØ¶Ø­ Ø­ØªÙ‰ Ù„Ø§ ØªØ®ØªÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
/* ØªØ«Ø¨ÙŠØª Ø§Ù„ØµÙØ­Ø© (Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±) */
html,body{overflow:hidden}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 85% -10%, color-mix(in oklab, var(--brand) 20%, transparent), transparent 60%),
    radial-gradient(1000px 700px at -10% 100%, color-mix(in oklab, var(--brand) 20%, transparent), transparent 55%),
    var(--bg);
  color:var(--text);
  font:14px/1.5 "Segoe UI",Inter,Roboto,system-ui,-apple-system,sans-serif;
}

/* Ù„Ùˆ ØªØ±ÙŠØ¯ Ø®Ù„ÙÙŠØ© ØµØ§ÙÙŠØ© ÙÙŠ Ø§Ù„ØºØ§Ù…Ù‚ ÙÙ‚Ø·:
// html[data-theme="dark"] body{ background: var(--bg); }
*/

.container{max-width:1120px;margin:32px auto;padding:0 16px}
.header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
.title{font-size:18px;font-weight:700}
.btn{
  display:inline-flex;gap:8px;align-items:center;
  border:1px solid var(--ring);
  background:var(--card); color:var(--text);
  padding:10px 14px; border-radius:12px;
  cursor:pointer; text-decoration:none;
}
.panel{
  background:var(--card);
  border:1px solid var(--ring);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
}
.toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px}
.form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form .full{grid-column:1/-1}
label{display:block;color:var(--muted);font-size:12px;margin:7px 0 6px}
input,select,textarea{
  width:100%; padding:10px 12px; border-radius:12px;
  border:1px solid var(--ring); outline:none;
  background:var(--card); color:var(--text);
}
textarea{min-height:90px; resize:vertical}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;letter-spacing:.3px}

/* Ù„Ù…Ø³Ø© ØªØ±ÙƒÙŠØ² ÙˆØ§Ø¶Ø­Ø© */
input:focus, select:focus, textarea:focus{
  border-color: var(--brand);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand) 35%, transparent);
}

.toast{
  position:fixed; right:16px; bottom:16px; background:#111827; color:#F9FAFB;
  padding:12px 14px; border-radius:12px; box-shadow:var(--shadow); display:none;
}
.toast.ok{background:linear-gradient(135deg,#16A34A,#22D3A6)}
.toast.err{background:linear-gradient(135deg,#EF4444,#F14668)}

#formTitle{display:none;}

#formDesc{display:none;}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="title" id="pageTitle">ğŸ“‹ Employee Delay</div>
    <a href="../index.html" class="btn">âŸµ Back</a>
  </div>
  <div class="panel">
    <div class="toolbar">
      <div>
        <div id="formTitle" style="font-weight:700;font-size:16px"></div>
        <div id="formDesc" style="color:var(--muted);font-size:12px"></div>
      </div>
      <div><button id="submitBtn" class="btn" style="background:var(--brand);color:#fff;border-color:transparent">Submit</button></div>
    </div>
    <form id="dynForm" class="form"></form>
  </div>
</div>
<div id="toast" class="toast">Saved</div>

<script>
/* ===== Helpers ===== */
const API_KEY="", DEFAULT_FLOW_URL="";
const DATE_FMT='DD-MM-YYYY', TIME_FMT='HH:mm';

function normalizeDigits(s){ if(!s) return s; const ar='Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'; return String(s).replace(/[Ù -Ù©]/g, ch => String(ar.indexOf(ch))) }
function toDDMMYYYY(s){
  s=normalizeDigits(s); if(!s) return '';
  if(/^\d{2}-\d{2}-\d{4}$/.test(s)) return s;
  if(/^\d{4}-\d{2}-\d{2}$/.test(s)){ const y=s.slice(0,4),m=s.slice(5,7),d=s.slice(8,10); return `${d}-${m}-${y}` }
  return s;
}
function to24h(t){
  t=normalizeDigits(t);
  const m=String(t||'').match(/(\d{1,2}):(\d{2})/);
  if(!m) return '';
  let hh=Math.max(0,Math.min(23,parseInt(m[1],10)||0));
  const mm=m[2];
  return String(hh).padStart(2,'0')+':'+mm;
}
function showToast(msg,isErr=false){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.toggle('ok',!isErr);
  t.classList.toggle('err',isErr);
  t.style.display='block';
  setTimeout(()=>t.style.display='none',2200);
}
function attachMasks(root){
  root.querySelectorAll('input[data-mask="time"]').forEach(el=>{
    el.addEventListener('input',()=>{
      let v=normalizeDigits(el.value).replace(/[^0-9]/g,'').slice(0,4);
      if(v.length>=3) v=v.slice(0,2)+':'+v.slice(2);
      el.value=v;
    });
    el.addEventListener('blur',()=>{
      if(/^(\d{1,2}):(\d{2})$/.test(el.value)) el.value=to24h(el.value);
    });
  });
  root.querySelectorAll('input[data-mask="date"]').forEach(el=>{
    el.addEventListener('input',()=>{
      let v=normalizeDigits(el.value).replace(/[^0-9]/g,'').slice(0,8);
      if(v.length>=5) v=v.slice(0,2)+'-'+v.slice(2,4)+'-'+v.slice(4);
      else if(v.length>=3) v=v.slice(0,2)+'-'+v.slice(2);
      el.value=v;
    });
  });
}

/* ===== Dynamic form ===== */
function boot(formDef){
  document.title=formDef.title;
  document.getElementById('pageTitle').textContent=formDef.title;
  document.getElementById('formTitle').textContent=formDef.title;
  document.getElementById('formDesc').textContent=formDef.description||'';

  const dyn=document.getElementById('dynForm');
  dyn.innerHTML='';

  formDef.fields.forEach(f=>{
    const w=document.createElement('div');
    if(f.type==='textarea') w.className='full';
    const id=formDef.id+'_'+f.name;
    const req=f.required?'required':'';
    let c='';
    if(f.type==='select'){
      c=`<select id="${id}" ${req}>${(f.options||[]).map(v=>`<option>${v}</option>`).join('')}</select>`;
    }else if(f.type==='textarea'){
      c=`<textarea id="${id}" ${req}></textarea>`;
    }else if(f.type==='time'){
      c=`<input id="${id}" type="text" class="mono" data-mask="time" inputmode="numeric" maxlength="5" placeholder="${TIME_FMT}" pattern="^([01]\\d|2[0-3]):[0-5]\\d$" ${req}/>`;
    }else if(f.type==='date'){
      c=`<input id="${id}" type="text" class="mono" data-mask="date" inputmode="numeric" maxlength="10" placeholder="${DATE_FMT}" pattern="^([0-2]\\d|3[01])-(0\\d|1[0-2])-\\d{4}$" ${req}/>`;
    }else if(f.type==='number'){
      c=`<input id="${id}" type="number" step="any" ${req}/>`;
    }else{
      c=`<input id="${id}" type="text" ${req}/>`;
    }
    w.innerHTML=`<label for="${id}">${f.label||f.name}${f.required?' *':''}</label>${c}`;
    dyn.appendChild(w);
  });

  attachMasks(dyn);

  document.getElementById('submitBtn').onclick=async()=>{
    const payload={}; let ok=true;
    formDef.fields.forEach(f=>{
      const el=document.getElementById(formDef.id+'_'+f.name);
      let v=(el.value||'').trim();
      v=normalizeDigits(v);
      if(f.type==='date') v=toDDMMYYYY(v);
      if(f.type==='time') v=to24h(v);

      if(f.required && !v){ el.style.borderColor='crimson'; ok=false; }
      else if(el.hasAttribute('pattern') && v){
        const rx=new RegExp(el.getAttribute('pattern'));
        if(!rx.test(v)){ el.style.borderColor='crimson'; ok=false; }
        else el.style.borderColor='var(--ring)';
      }else{
        el.style.borderColor='var(--ring)';
      }
      payload[f.name]=v;
    });

    if(!ok){ showToast('Please fill/format required fields (HH:mm, DD-MM-YYYY)', true); return; }

    if(!formDef.flowUrl){
      showToast('Saved (local only)', false);
      dyn.reset?.();
      return;
    }

    try{
      const r=await fetch(formDef.flowUrl||DEFAULT_FLOW_URL,{
        method:'POST',
        headers:{'Content-Type':'application/json','x-api-key':API_KEY},
        body:JSON.stringify({formId:formDef.id,submittedAt:new Date().toISOString(),data:payload})
      });
      if(!r.ok) throw new Error(await r.text()||('HTTP '+r.status));
      showToast('Saved successfully âœ“');
      dyn.reset?.();
    }catch(e){
      showToast('Error: '+(e.message||'Failed'), true);
    }
  };
}

/* ===== Form Definition ===== */
const FORM_DEF={
  id:"employee_delay",
  title:"Employee Delay",
  description:"Employee late arrivals.",
  flowUrl:"",
  fields:[
    {name:"Date",label:"Date",type:"date",required:true},
    {name:"Shift",label:"Shift",type:"select",options:["Shift A","Shift B","Shift C"]},
    {name:"Department",label:"Department",type:"select",options:["TCC","FIC Saudia","FIC Nas","LC Saudia","LC Foreign"]},
    {name:"EmployeeID",label:"Employee ID",type:"text",required:true},
    {name:"EmployeeName",label:"Employee Name",type:"text"},
    {name:"DelayMinutes",label:"Delay Minutes",type:"number"},
    {name:"ReasonForDelay",label:"Reason for Delay",type:"textarea"},
    {name:"DelayNotificationStatus",label:"Delay Notification Status",type:"text"}
  ]
};
boot(FORM_DEF);
</script>
</body>
</html>
