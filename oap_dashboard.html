<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>OAP â€¢ Ù„ÙˆØ­Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Ø®Ø· -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --border-soft: rgba(148, 163, 184, 0.45);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #020617 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    .top-nav {
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 18px;
      background: radial-gradient(circle at top, #020617 0, #020617 45%, #000 100%);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-logo {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .nav-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .nav-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 6px 14px;
      font-size: 0.78rem;
      background: #020617;
      color: #e5e7eb;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav-btn span.icon {
      font-size: 0.9rem;
    }

    .nav-btn:hover {
      background: #020617;
      border-color: var(--accent);
    }

    .nav-btn.active {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      border-color: transparent;
      color: #020617;
      box-shadow: 0 8px 26px rgba(56, 189, 248, 0.55);
    }

    /* Ø§Ù„ØµÙØ­Ø© */
    .page {
      max-width: 1280px;
      margin: 0 auto;
      padding: 20px 20px 40px;
    }

    header.page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 18px;
    }

    .header-main h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }

    .header-main p {
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .header-sub {
      text-align: left;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± */
    .filters-bar {
      margin-bottom: 18px;
      padding: 10px 14px;
      border-radius: 16px;
      border: 1px solid rgba(15, 23, 42, 0.9);
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.18), #020617 55%);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .filters-bar label {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-inline-start: 4px;
    }

    .filters-group {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* Ù…Ø±Ø¨Ø¹ ØªØ§Ø±ÙŠØ® Ù…Ø·ÙˆÙ‘Ø± (Ø³ØªØ§ÙŠÙ„ Ø­Ø¯ÙŠØ«) */
    .date-pill {
      position: relative;
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #020617;
      padding-inline: 10px;
      padding-block: 4px;
    }

    .date-pill input[type="date"] {
      border: none;
      background: transparent;
      color: var(--text-main);
      font-size: 0.8rem;
      padding: 4px 4px;
      outline: none;
    }

    .date-pill label {
      font-size: 0.72rem;
      color: var(--text-soft);
      margin-inline-end: 6px;
      white-space: nowrap;
    }

    .date-pill span.icon {
      font-size: 0.9rem;
      color: var(--accent);
      margin-inline-start: 4px;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
    .dept-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .dept-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 4px 10px;
      font-size: 0.78rem;
      background: #020617;
      color: var(--text-soft);
      cursor: pointer;
      transition: all 0.18s ease-out;
    }

    .dept-pill.active {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #020617;
      border-color: transparent;
      box-shadow: 0 6px 18px rgba(56, 189, 248, 0.5);
    }

    .filters-actions {
      display: flex;
      gap: 6px;
      margin-inline-start: auto;
    }

    .btn-ghost {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 7px 12px;
      font-size: 0.78rem;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
    }

    .btn-ghost:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 18px;
    }

    .metric-card {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95) 0, #020617 55%);
      border-radius: 20px;
      padding: 10px 14px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      box-shadow: 0 16px 38px rgba(15, 23, 42, 0.98);
    }

    .metric-label {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 1.45rem;
      font-weight: 600;
    }

    .metric-sub {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* Ø£Ø³ÙÙ„: Ø§Ù„Ø±Ø³Ù… ÙÙ‚Ø· Ø¨Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ */
    .bottom-grid {
      margin-top: 10px;
    }

    .chart-card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9) 0, #020617 50%, #020617 100%);
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.60);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
      padding: 14px 18px;
      min-height: 260px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .chart-title {
      font-size: 0.9rem;
    }

    .chart-sub {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .chart-legend {
      font-size: 0.74rem;
      color: var(--text-soft);
    }

    canvas {
      width: 100% !important;
      max-height: 260px;
    }

    @media (max-width: 1024px) {
      .metrics-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .page {
        padding-inline: 12px;
      }
      header.page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .metrics-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .filters-actions {
        width: 100%;
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯ -->
  <script src="nxs_config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // OAP Dashboard â€” auth guard + theme sync
  (function() {
    const { createClient } = supabase;
    const sb = createClient(window.NXS_SUPABASE_URL, window.NXS_SUPABASE_ANON_KEY);
    const KEY = 'pref-theme';
    const root = document.documentElement;

    async function requireAuth() {
      try {
        const { data, error } = await sb.auth.getSession();
        if (error || !data || !data.session) {
          window.location.href = 'Login.html';
          return;
        }
      } catch (e) {
        window.location.href = 'Login.html';
      }
    }

    function initTheme() {
      try {
        const saved = localStorage.getItem(KEY);
        if (saved) {
          root.setAttribute('data-theme', saved);
        }
      } catch (_) {}
      window.addEventListener('storage', function(e) {
        if (e.key === KEY && e.newValue) {
          try {
            root.setAttribute('data-theme', e.newValue);
          } catch (_) {}
        }
      });
    }

    document.addEventListener('DOMContentLoaded', function() {
      requireAuth();
      initTheme();
    });
  })();
</script>
<div class="top-nav">
    <div class="nav-left">
      <div class="nav-logo">OAP â€¢ AirportOps</div>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="window.location.href='index.html'">
        <span class="icon">ğŸ¤–</span>
        <span>Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
      </button>
      <button class="nav-btn active" onclick="window.location.href='nxs_dashboard.html'">
        <span class="icon">ğŸ“Š</span>
        <span>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
      </button>
    </div>
  </div>

  <div class="page">
    <header class="page-header">
      <div class="header-main">
        <h1>Ù„ÙˆØ­Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</h1>
        <p>Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŒ Ø§Ù„ØºÙŠØ§Ø¨Ø§ØªØŒ Ø§Ù„ØªØ£Ø®ÙŠØ±ØŒ ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©.</p>
      </div>
      <div class="header-sub">
        <div>Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø®Ø·ÙŠ ÙŠØ¹Ø±Ø¶ Ø§Ù„ØºÙŠØ§Ø¨Ø§Øª Ø´Ù‡Ø±ÙŠØ§Ù‹ (Jan â†’ Dec)ØŒ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±.</div>
      </div>
    </header>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± -->
    <section class="filters-bar">
      <div class="filters-group">
        <div class="date-pill">
          <label for="fromDate">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="fromDate" />
          <span class="icon">ğŸ“…</span>
        </div>

        <div class="date-pill">
          <label for="toDate">Ø¥Ù„Ù‰</label>
          <input type="date" id="toDate" />
          <span class="icon">ğŸ“…</span>
        </div>
      </div>

      <div class="filters-group">
        <label>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
        <div id="deptButtons" class="dept-buttons">
          <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªÙÙ†Ø´Ø£ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        </div>
      </div>

      <div class="filters-actions">
        <button class="btn-ghost" id="resetFilters">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
      </div>
    </section>

    <!-- Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© -->
    <section class="metrics-grid">
      <div class="metric-card">
        <div class="metric-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
        <div class="metric-value" id="totalEmployees">â€“</div>
        <div class="metric-sub" id="summaryDeptLabel"></div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨ (Ø¶Ù…Ù† Ø§Ù„ÙØªØ±Ø©)</div>
        <div class="metric-value" id="totalAbsence">â€“</div>
        <div class="metric-sub" id="summaryDateRange"></div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªØ£Ø®ÙŠØ±</div>
        <div class="metric-value" id="totalDelay">â€“</div>
        <div class="metric-sub">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ£Ø®ÙŠØ± Ù„Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ</div>
        <div class="metric-value" id="totalOvertime">â€“</div>
        <div class="metric-sub">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ø§Ù„ÙØªØ±Ø©.</div>
      </div>
    </section>

    <!-- Ø§Ù„Ø±Ø³Ù… -->
    <section class="bottom-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±</div>
          <div class="chart-legend" id="chartRangeLabel"></div>
        </div>
        <div class="chart-sub">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ø¹Ø±Ø¶ Ø®Ø· ÙˆØ§Ø­Ø¯ Ù„Ù‚Ø³Ù… Ù…Ø­Ø¯Ø¯ Ø£Ùˆ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ø¹Ø§Ù‹.</div>
        <canvas id="absenceChart"></canvas>
      </div>
    </section>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:8000"; // ØºÙŠÙ‘Ø±Ù‡Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø¢Ø®Ø±

    const { createClient: createSbClient } = supabase;
const sbDashboard = createSbClient(window.NXS_SUPABASE_URL, window.NXS_SUPABASE_ANON_KEY);

async function apiFetch(path, options = {}) {
  const base = '';
  const { data, error } = await sbDashboard.auth.getSession();
  if (error || !data || !data.session) {
    window.location.href = 'Login.html';
    throw new Error('Not authenticated');
  }
  const jwt = data.session.access_token;
  const headers = options.headers ? { ...options.headers } : {};
  headers['Authorization'] = 'Bearer ' + jwt;
  headers['Content-Type'] = headers['Content-Type'] || 'application/json';
  const res = await fetch(base + path, { ...options, headers });
  if (!res.ok) {
    const text = await res.text();
    throw new Error('API ' + res.status + ': ' + text);
  }
  return res.json();
}

    let absenceChartInstance = null;
    let absenceData = { months: [], departments: [], matrix: [], date_from: "", date_to: "" };
    let activeDept = "ALL";

    function buildSummaryQueryString() {
      const from = document.getElementById("fromDate").value;
      const to = document.getElementById("toDate").value;

      const params = new URLSearchParams();
      if (from) params.set("date_from", from);
      if (to) params.set("date_to", to);
      if (activeDept && activeDept !== "ALL") params.set("department", activeDept);

      const qs = params.toString();
      return qs ? "?" + qs : "";
    }

    function buildDateOnlyQueryString() {
      const from = document.getElementById("fromDate").value;
      const to = document.getElementById("toDate").value;

      const params = new URLSearchParams();
      if (from) params.set("date_from", from);
      if (to) params.set("date_to", to);

      const qs = params.toString();
      return qs ? "?" + qs : "";
    }

    function formatDelayMinutes(totalMinutes) {
      const minutes = Math.max(0, Math.round(totalMinutes || 0));
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      if (hours === 0) {
        return mins + "min";
      }
      if (mins === 0) {
        return hours + "hr";
      }
      return hours + "hr " + mins + "min";
    }

    async function loadSummary() {
      const qs = buildSummaryQueryString();
      const url = API_BASE + "/dashboard/summary" + qs;

      try {
        const res = await fetch(url);
        if (!res.ok) {
          console.error("Summary error:", await res.text());
          return;
        }
        const data = await res.json();

        document.getElementById("totalEmployees").textContent =
          data.total_employees.toLocaleString("en-US");
        document.getElementById("totalAbsence").textContent =
          data.total_absence_days.toLocaleString("en-US");

        document.getElementById("totalDelay").textContent =
          formatDelayMinutes(data.total_delay_minutes);

        document.getElementById("totalOvertime").textContent =
          Number(data.total_overtime_hours || 0).toLocaleString("en-US", {
            maximumFractionDigits: 1,
          });

        const deptLabel =
          data.department && data.department !== "ALL"
            ? "Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: " + data.department
            : "ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…";

        document.getElementById("summaryDeptLabel").textContent = deptLabel;

        const rangeText = "Ù…Ù† " + data.date_from + " Ø¥Ù„Ù‰ " + data.date_to;
        document.getElementById("summaryDateRange").textContent = rangeText;
      } catch (err) {
        console.error("Summary exception:", err);
      }
    }

    async function loadAbsenceMonthly() {
      const qs = buildDateOnlyQueryString();
      const url = API_BASE + "/dashboard/absence-by-month" + qs;

      try {
        const res = await fetch(url);
        if (!res.ok) {
          console.error("Absence-by-month error:", await res.text());
          return;
        }
        const data = await res.json();
        absenceData = data;

        document.getElementById("chartRangeLabel").textContent =
          "Ù…Ù† " + data.date_from + " Ø¥Ù„Ù‰ " + data.date_to;

        buildDeptButtons();
        renderAbsenceChart();
      } catch (err) {
        console.error("Absence-by-month exception:", err);
      }
    }

    function buildDeptButtons() {
      const container = document.getElementById("deptButtons");
      container.innerHTML = "";

      const departments = absenceData.departments || [];

      // Ø²Ø± Ø§Ù„ÙƒÙ„
      const allBtn = document.createElement("button");
      allBtn.className = "dept-pill" + (activeDept === "ALL" ? " active" : "");
      allBtn.textContent = "Ø§Ù„ÙƒÙ„";
      allBtn.dataset.dept = "ALL";
      allBtn.onclick = () => {
        activeDept = "ALL";
        buildDeptButtons();
        renderAbsenceChart();
        loadSummary();
      };
      container.appendChild(allBtn);

      departments.sort().forEach((lab) => {
        const btn = document.createElement("button");
        btn.className = "dept-pill" + (activeDept === lab ? " active" : "");
        btn.textContent = lab || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        btn.dataset.dept = lab;
        btn.onclick = () => {
          activeDept = lab;
          buildDeptButtons();
          renderAbsenceChart();
          loadSummary();
        };
        container.appendChild(btn);
      });
    }

    function renderAbsenceChart() {
      const months = absenceData.months || [];
      const departments = absenceData.departments || [];
      const matrix = absenceData.matrix || [];

      let values = new Array(months.length).fill(0);

      if (activeDept === "ALL") {
        // Ù…Ø¬Ù…ÙˆØ¹ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„ÙƒÙ„ Ø´Ù‡Ø±
        for (let j = 0; j < months.length; j++) {
          let sum = 0;
          for (let i = 0; i < matrix.length; i++) {
            sum += matrix[i][j] || 0;
          }
          values[j] = sum;
        }
      } else {
        const idx = departments.indexOf(activeDept);
        if (idx >= 0) {
          values = matrix[idx].slice();
        }
      }

      const ctx = document.getElementById("absenceChart").getContext("2d");
      if (absenceChartInstance) {
        absenceChartInstance.destroy();
      }

      absenceChartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels: months,
          datasets: [
            {
              label:
                activeDept === "ALL"
                  ? "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨ (ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…)"
                  : "Ø£ÙŠØ§Ù… Ø§Ù„ØºÙŠØ§Ø¨ â€” " + activeDept,
              data: values,
              tension: 0.35,
              fill: false,
              borderColor: "#38bdf8",
              borderWidth: 2,
              pointRadius: 3,
              pointHoverRadius: 4,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: "#e5e7eb",
              },
            },
          },
          scales: {
            x: {
              ticks: { color: "#9ca3af" },
              grid: { color: "rgba(55,65,81,0.5)" },
            },
            y: {
              ticks: { color: "#9ca3af" },
              grid: { color: "rgba(31,41,55,0.7)" },
            },
          },
        },
      });
    }

    function resetFilters() {
      document.getElementById("fromDate").value = "";
      document.getElementById("toDate").value = "";
      activeDept = "ALL";
      reloadAll();
    }

    function reloadAll() {
      loadSummary();
      loadAbsenceMonthly();
    }

    // Ø§Ù„ÙÙ„Ø§ØªØ± ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¯ÙˆÙ† Ø²Ø± ØªØ·Ø¨ÙŠÙ‚
    document.getElementById("fromDate").addEventListener("change", reloadAll);
    document.getElementById("toDate").addEventListener("change", reloadAll);
    document.getElementById("resetFilters").addEventListener("click", resetFilters);

    // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    reloadAll();
  </script>
</body>
</html>
