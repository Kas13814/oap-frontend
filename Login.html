<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OAP Login | تسجيل دخول اوبريشن KAS</title>
  <meta name="description" content="صفحة تسجيل الدخول الرسمية لمنصة OAP (اوبريشن). للوصول إلى نظام KAS للتحليل والعمليات، يرجى إدخال بيانات الاعتماد الخاصة بك.">
  <meta name="keywords" content="OAP, oap, KAS, kas, اوبريشن, OAP Login">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --radius-xl: 22px;
      --shadow-soft: 0 28px 80px rgba(15, 23, 42, 0.55);
      --ease: cubic-bezier(.22,.61,.36,1);
    }
    [data-theme="light"]{
      --bg:#f4f2ec;
      --ink:#111827;
      --muted:#6b7280;
      --panel:#ffffff;
      --panel-soft:#f3f4f6;
      --line:#d1d5db;
      --accent:#111827;
      --accent-soft:rgba(15,23,42,.06);
      --danger:#b91c1c;
      --success:#16a34a;
    }
    [data-theme="dark"]{
      --bg:#020617;
      --ink:#e5e7eb;
      --muted:#9ca3af;
      --panel:#020617;
      --panel-soft:#020617;
      --line:rgba(148,163,184,.45);
      --accent:#38bdf8;
      --accent-soft:rgba(56,189,248,.16);
      --danger:#ef4444;
      --success:#22c55e;
    }
    *{box-sizing:border-box;}
    html,body{margin:0;padding:0;height:100%;}
    body{
      min-height:100vh;
      font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at top left,rgba(56,189,248,.12),transparent 55%),
        radial-gradient(circle at bottom right,rgba(129,140,248,.18),transparent 60%),
        var(--bg);
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px 10px;
      -webkit-font-smoothing:antialiased;
    }
    .card{
      width:100%;
      max-width:420px;
      border-radius:var(--radius-xl);
      background:var(--panel);
      border:1px solid rgba(209,213,219,.9);
      box-shadow:var(--shadow-soft);
      padding:22px 22px 18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    [data-theme="dark"] .card{
      background:radial-gradient(circle at top left,rgba(15,23,42,.96),rgba(15,23,42,1));
      border-color:rgba(51,65,85,.9);
    }
    .logo-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .logo-left{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo-box{
      width:40px;
      height:40px;
      border-radius:14px;
      background:
        radial-gradient(circle at 0 0,rgba(56,189,248,.4),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(129,140,248,.3),transparent 55%),
        #020617;
      border:1px solid rgba(148,163,184,.7);
      display:grid;
      place-items:center;
      color:#e5e7eb;
      font-weight:600;
      box-shadow:0 18px 40px rgba(15,23,42,.7);
    }
    .logo-text-main{
      font-size:16px;
      font-weight:600;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .logo-text-sub{
      font-size:11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .mode-pill{
      border-radius:999px;
      padding:4px 10px;
      border:1px solid rgba(148,163,184,.7);
      font-size:11px;
      color:var(--muted);
      background:var(--panel-soft);
    }
    .fields{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:12px;
    }
    .label{color:var(--muted);font-weight:500;}
    .required{color:var(--danger);margin-left:3px;}
    .input{
      border-radius:999px;
      border:1px solid rgba(209,213,219,1);
      background:#ffffff;
      color:var(--ink);
      padding:10px 14px;
      font-size:13px;
      outline:none;
      transition:border-color .16s var(--ease),box-shadow .16s var(--ease);
    }
    [data-theme="dark"] .input{
      background:rgba(15,23,42,.96);
      border-color:rgba(55,65,81,.9);
    }
    .input::placeholder{color:rgba(148,163,175,.9);}
    .actions{
      margin-top:8px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .btn-main{
      border-radius:999px;
      border:1px solid transparent;
      padding:10px 16px;
      font-size:13px;
      font-weight:500;
      letter-spacing:.09em;
      text-transform:uppercase;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      cursor:pointer;
      background:linear-gradient(135deg,var(--accent),#000000);
      color:#f9fafb;
      box-shadow:0 22px 55px rgba(15,23,42,.56);
      transition:background .14s var(--ease),box-shadow .14s var(--ease),transform .08s var(--ease);
    }
    .btn-main:hover{transform:translateY(-1px);box-shadow:0 26px 60px rgba(15,23,42,.6);}
    .btn-main:active{transform:translateY(0);box-shadow:0 18px 46px rgba(15,23,42,.7);}
    .links-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:space-between;
      font-size:12px;
    }
    .link-btn{
      border-radius:999px;
      padding:8px 12px;
      border:1px solid rgba(209,213,219,.9);
      background:var(--panel-soft);
      color:var(--ink);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      font-weight:500;
    }
    .link-btn span.icon{font-size:13px;}
    .bottom-row{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      font-size:11px;
      color:var(--muted);
    }
    .bottom-row a{
      color:var(--accent);
      text-decoration:none;
      font-weight:500;
    }
    .bottom-row a:hover{text-decoration:underline;}
    .status{
      margin-top:6px;
      font-size:12px;
      line-height:1.6;
      color:var(--muted);
      white-space:pre-line;
    }
    .status.error{color:var(--danger);}
    .status.success{color:var(--success);}
  
.status-box {
  margin-top: 10px;
  font-size: 13px;
  min-height: 18px;
}
.status-ok {
  color: #0a7f2e;
}
.status-error {
  color: #b00020;
}

</style>
</head>
<body>
  <script>
    (function(){
      const root=document.documentElement;
      const KEY='pref-theme';
      const saved=localStorage.getItem(KEY);
      const initial=saved || (window.matchMedia && matchMedia('(prefers-color-scheme: light)').matches ? 'light':'dark');
      root.setAttribute('data-theme',initial);
    })();
  </script>

  <div class="card">
    <div class="logo-row">
      <div class="logo-left">
        <div class="logo-box">NX</div>
        <div>
          <div class="login-title">OAP Platform</div>
          <div class="logo-text-sub">LOGIN</div>
        </div>
      </div>
      <div class="mode-pill">Secure login</div>
    </div>

    <div class="fields">
      <div class="field">
        <div class="label">Employee ID<span class="required">*</span></div>
        <input id="employeeId" class="input" type="text" placeholder="Your SGS employee ID" autocomplete="username" />
      </div>
      <div class="field">
        <div class="label">Password<span class="required">*</span></div>
        <input id="password" class="input" type="password" placeholder="Password" autocomplete="current-password" />
      </div>
    </div>

    <div class="actions">
      <button id="btnLogin" class="btn-main" type="button">
        <span>Sign in</span>
      </button>

      <div class="links-row">
        <a class="link-btn" href="password_full_flow.html">
          <span class="icon">⟳</span>
          <span>Reset password</span>
        </a>
        <a class="link-btn" href="joining.html">
          <span class="icon">✚</span>
          <span>Join workspace</span>
        </a>
      </div>
    </div>

    <div id="status" class="status"></div>

    <div class="bottom-row">
      <span></span>
      <a href="index.html">Back to home</a>
    </div>
  </div>

  <script src="nxs_config.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // OAP Login using Supabase Auth
  const { createClient } = supabase;
  const sb = createClient(window.NXS_SUPABASE_URL, window.NXS_SUPABASE_ANON_KEY);

  const employeeInput = document.getElementById("Employee_login");
  const passwordInput = document.getElementById("Password");
  const btnLogin = document.getElementById("Login_button");
  const statusBox = document.getElementById("status_box");

  function setStatus(message, type) {
    if (!statusBox) return;
    statusBox.textContent = message || "";
    statusBox.className = "";
    if (message) {
      statusBox.classList.add(type === "error" ? "status-error" : "status-ok");
    }
  }

  async function callLogin() {
    const employee_login = (employeeInput.value || "").trim();
    const password = (passwordInput.value || "").trim();

    if (!employee_login || !password) {
      setStatus("Please enter both Employee ID and Password.", "error");
      return;
    }

    // بناء البريد من رقم الموظف
    const email = employee_login + "@saudiags.com";

    btnLogin.disabled = true;
    setStatus("Checking credentials with OAP Auth...", "");

    try {
      const { data, error } = await sb.auth.signInWithPassword({
        email,
        password
      });

      if (error) {
        const code = error.message || error.name || "LOGIN_FAILED";
        if (code.includes("Invalid login credentials")) {
          setStatus("Invalid Employee ID or password.", "error");
        } else {
          setStatus("Login failed: " + code, "error");
        }
        return;
      }

      const session = data && data.session;
      const jwt = session && session.access_token;
      if (jwt) {
        try {
          localStorage.setItem("oap_jwt", jwt);
        } catch (_) {
          // ignore quota errors
        }
      }

      setStatus("Login successful. Welcome to OAP.", "ok");
      setTimeout(() => {
        window.location.href = "index.html";
      }, 800);
    } catch (err) {
      console.error(err);
      const msg = (err && err.message) || "Network error.";
      setStatus("Login failed: " + msg, "error");
    } finally {
      btnLogin.disabled = false;
    }
  }

  if (btnLogin) {
    btnLogin.addEventListener("click", (e) => {
      e.preventDefault();
      callLogin();
    });
  }

  if (passwordInput) {
    passwordInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        callLogin();
      }
    });
  }
</script>
</body>
</html>
