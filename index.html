<!-- build: 2025-10-21_#1 -->
<!DOCTYPE html>
<!-- build: 2025-10-21_#1 -->
<html lang="ar" dir="ltr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OPERATIONS â€” ANALYTICS â€¢ PERFORMANCE â€¢ Services</title>
<link rel="manifest" href="manifest.webmanifest">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

<style>
:root{
  /* Ø£Ù„ÙˆØ§Ù† ÙˆØ«ÙˆØ§Ø¨Øª Ø¹Ø§Ù…Ø© */
  --bg:#2A2A3C; --ink:#ECECF1; --muted:#B9B7C1; --line:#504E59; --accent:#ECECF1;
  --sidebarW: min(56vw, 220px);
  --ease: cubic-bezier(.22,.61,.36,1);

  /* ===== Ø´Ø§Ø´Ø© Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (ÙƒÙ…Ø§ ØªÙ… Ø¶Ø¨Ø·Ù‡Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§) ===== */
  --d-ops-x: 0px;  --d-ops-y: 20px;
  --d-ana-x: 0px;  --d-ana-y: 0px;  --d-ana-op: .95;
  --d-per-x: 0px;  --d-per-y: 0px;  --d-per-op: .9;

  /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± (Desktop) */
  --d-logo-x: -10px; --d-logo-y: -40px; --d-logo-scale: 75;
  --d-logo-w: 110px; --d-logo-h: 48px;  --d-logo-gap: 10px;

  /* Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ (Desktop) */
  --d-rect-x: 160px; --d-rect-y: -115px; --d-rect-scale: 75;
  --d-rect-w: 235px; --d-rect-h: 110px; --d-rect-round: 14px;
  --rect-slide-left:-18px; --rect-slide-right:26px;

  /* ===== ØªØ­ÙƒÙ… Ø§Ù„Ù‡Ø§ØªÙ (Ù„ÙˆØ­Ø© Settings) ===== */
  /* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø«Ù„Ø§Ø«Ø© */
  --m-ops-x:0vw;  --m-ops-y:3vh;  --m-ops-fs:14.8vw;
  --m-ana-x:12.5vw; --m-ana-y:3vh; --m-ana-fs:12.8vw;
  --m-per-x:12.5vw; --m-per-y:1vh; --m-per-fs:12.8vw;

  /* Ø§Ù„ÙˆÙ‚Øª Ùˆ Home */
  --m-time-x:0px; --m-time-y:0px;
  --m-home-x:0px; --m-home-y:0px;

  /* Ù†Øµ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© */
  --m-int-x:0px; --m-int-y:0px; --m-int-fs:16px;

  /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ù„Ù„Ù‡Ø§ØªÙ */
  --m-logo-x: 0vw; --m-logo-y: 0vh; --m-logo-w: 104px; --m-logo-h: 46px; --m-logo-gap: 8px; --m-logo-scale: 100;

  /* Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù‡Ø§ØªÙ */
  --m-rect-x:0vw; --m-rect-y:0vh; --m-rect-w:64vw; --m-rect-h:100px; --m-rect-round:12px;
  --m-rect-scale: 100; --m-rect-slide-left:-10px; --m-rect-slide-right:20px;

  /* Ø£Ù„ÙˆØ§Ù† ØµÙØ­Ø© Ø§Ù„Ù‡Ø§ØªÙ (ØºØ§Ù…Ù‚/ÙØ§ØªØ­) */
  --m-bg-dark:linear-gradient(180deg, #000000 0%, #0b0b0f 45%, #14141c 100%);
  --m-bg-light:#f4f2ec;
}

/* Light/Dark */
[data-theme="light"]{ --bg:#f4f2ec; --ink:#1d1e26; --muted:#6f6a66; --line:#bdb6ad; --accent:#212233; }
[data-theme="dark"]{
  --bg:linear-gradient(180deg, #000000 0%, #0b0b0f 45%, #14141c 100%); --ink:#ECECF1; --muted:#B9B7C1; --line:#504E59; --accent:#ECECF1;
  /* Ø·Ù„Ø¨Ùƒ: Ø§Ù„ÙƒÙ„Ù…ØªØ§Ù† Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø«Ø§Ù„Ø«Ø© 50% */
  --d-ana-op:.5;  /* ANALYTICS */
  --d-per-op: .9;  /* PERFORMANCE */
}

[data-theme="dark"] .divider__mobile-arrow span{ color:#ffffff; }
*{box-sizing:border-box}
html,body{ overflow:hidden !important;  margin:0; height:100% }
body{ overflow:hidden !important; 
  min-height:100%;
  background:var(--bg); color:var(--ink);
  font:400 16px/1.55 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  letter-spacing:.01em; 
  transition:background .25s ease, color .25s ease;
}

button, a { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
.clickable { pointer-events:auto }

/* ===== Layout / Sidebar ===== */
.layout{ display:grid; grid-template-columns: 0 1fr; height:100vh; width:100vw;  transition:grid-template-columns .001s linear; }
body.sidebar-open .layout{ grid-template-columns: var(--sidebarW) 1fr; }

.sidebar{
  grid-column:1; grid-row:1; background:var(--bg); color:var(--ink);
  z-index:5; display:flex; flex-direction:column; position:relative;
  opacity:0; visibility:hidden; pointer-events:none; transform:translate3d(-14px,0,0);
  transition: opacity .65s var(--ease), transform .65s var(--ease), visibility 0s linear .65s;
}
.sidebar.in{ opacity:1; visibility:visible; pointer-events:auto; transform:translate3d(0,0,0); transition: opacity .65s var(--ease), transform .65s var(--ease), visibility 0s; }
.sidebar__header{ position:sticky; top:0; z-index:1; padding:12px 12px 8px; border-bottom:1px solid rgba(255,255,255,.08); background:var(--bg); text-align:left; }
.sidebar__title{ font-size:13px; font-weight:700; letter-spacing:.08em; text-transform:uppercase; opacity:.95; }
.sidebar__close{ position:absolute; top:8px; right:8px; width:26px; height:26px; display:grid; place-items:center; cursor:pointer; background:none; border:none; border-radius:8px; }
.sidebar__close svg{ width:16px; height:16px; stroke:var(--ink); fill:none; stroke-width:2; }
.sidebar__content{ padding:18px 8px 14px; overflow:auto; }

/* Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© */
.side-list{ list-style:none; margin:10px 0 0; padding:0; display:flex; flex-direction:column; gap:6px; }
.side-h{ font:800 11px/1 Inter; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); opacity:.95; padding:8px 10px 2px; }
.side-item a{
  display:flex; align-items:center; gap:8px; padding:9px 10px;
  border-radius:10px; text-decoration:none; color:var(--ink);
  background:#121217; border:1px solid rgba(255,255,255,.06);
  transition:transform .15s, opacity .15s, background .15s;
}
.side-item a:hover{ opacity:.98; transform:translateX(2px); }
.side-item svg{ width:16px; height:16px; stroke:var(--ink); fill:none; stroke-width:2; }

.app{ grid-column:2; grid-row:1; position:relative; height:100%; width:100%; z-index:100; transition: box-shadow .26s var(--ease); box-shadow:none; }
body.sidebar-open .app{ box-shadow: -10px 0 14px rgba(0,0,0,.12), -3px 0 6px rgba(0,0,0,.06); }

.side-toggle{ position:fixed; top:16px; left:16px; z-index:4000; width:36px; height:36px; display:grid; place-items:center; cursor:pointer; background:none; border:none; border-radius:10px; }
.side-toggle svg{ width:22px; height:22px; stroke:var(--ink); fill:none; stroke-width:2; }

/* ===== Hero ===== */
.hero{ position:relative; height:100vh; min-height:100vh; padding:40px 6vw 0 6vw;  }
.hero__brand{
  font-family:"Cormorant Garamond","Times New Roman",serif; font-weight:600; line-height:.88; letter-spacing:.005em; color:var(--accent);
  font-size:min(15.6vw,182px); position:relative; z-index:2;
  transform: translate(var(--d-ops-x), var(--d-ops-y));
}
.hero__ghosts{ position:absolute; top:8vh; left:6vw; pointer-events:none; user-select:none; font-family:"Cormorant Garamond","Times New Roman",serif; font-weight:400; line-height:.9; letter-spacing:.01em; z-index:1; }
.hero__ghosts span{ display:block; white-space:nowrap; }
/* ANALYTICS */
.ghost-1{
  font-size:min(13.8vw,156px); color:#C4C1C9; opacity: var(--d-ana-op, .95);
  transform:translate(calc(400px + var(--d-ana-x)), calc(117px + var(--d-ana-y)));
}
/* PERFORMANCE */
.ghost-2{
  margin-top:12vh; font-size:min(13.8vw,156px); color:#EBE7E6; opacity: var(--d-per-op, .92);
  transform:translate(calc(400px + var(--d-per-x)), calc(-26px + var(--d-per-y)));
}

/* ===== Divider ===== */
/* Ø³Ù‡Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø®ÙÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
.divider__mobile-arrow{ display:none; }

.divider{ position:absolute; left:0; right:0; top:50vh; transform:translateY(-50%); padding:12px 0 0; height:54px; z-index:3500; }
.divider::before{ content:""; position:absolute; left:6vw; right:6vw; top:0; height:1px; background:var(--line);}   
.divider__grid{ position:relative; display:grid; grid-template-columns: 1fr 1fr 1fr; align-items:center; gap:12px; padding:8px 6vw 0 6vw; font-size:12px; color:var(--muted);} 
.divider__time{ justify-self:start; }
.divider__center{ justify-self:center; text-transform:uppercase; letter-spacing:.18em; font-weight:600; font-size:11px; opacity:.85; display:flex; align-items:center; gap:6px; } 
.divider__nav{ justify-self:end; }
.divider__nav ul{ list-style:none; margin:0; padding:0; display:flex; gap:min(4.6vw,40px);} 
.divider__nav a{ text-decoration:none; color:#f5f5f5; opacity:.86; font-size:12px; transition:opacity .2s ease;} 
.divider__nav a:hover{ opacity:1; color:#ffffff; }
.divider__nav .active{ opacity:1; color:var(--muted);} 

/* ===== Intro ===== */
.intro{ position:relative; right:6vw; bottom:6vh; max-width:720px; width:100%; margin:0; padding:0; color:var(--ink); text-align:left; z-index:2; } 
.intro p{ margin:0; font-size:clamp(18px,1.5vw,20px); line-height:1.85; }

/* ===== Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± (desktop baseline) ===== */
.logo-over-time{
  position:absolute; top:0; left:0;
  transform:
    translateX(var(--d-logo-x))
    translateY(calc(-100% - var(--d-logo-gap))) translateY(var(--d-logo-y))
    scale(calc(var(--d-logo-scale) / 100));
  transform-origin:left bottom;
  width:var(--d-logo-w); height:var(--d-logo-h);
  display:grid; place-items:center; background:transparent; border:none;
  z-index:3600; pointer-events:auto;
}
.logo-over-time img{ max-width:90%; max-height:80%; object-fit:contain; display:block; }

/* ===== Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© (desktop baseline) ===== */
.logo-bg{
  position:absolute; top:0; left:0;
  width:var(--d-rect-w); height:var(--d-rect-h);
  transform:
    translate(calc(var(--d-rect-x) + var(--rect-slide-left)), var(--d-rect-y))
    scale(calc(var(--d-rect-scale) / 100));
  transform-origin:left bottom;
  border-radius: var(--d-rect-round);
  background: transparent; opacity:0; z-index:3595; pointer-events:none;
  transition: transform 1.1s var(--ease), opacity 1.1s var(--ease);
}
.logo-bg > img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; border-radius:inherit; }
.logo-over-time:hover ~ .logo-bg{
  opacity:1;
  transform:
    translate(calc(var(--d-rect-x) + var(--rect-slide-right)), var(--d-rect-y))
    scale(calc(var(--d-rect-scale) / 100));
}

/* ===== Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‡Ø§ØªÙ ===== */
@media (max-width:640px){
  .hero{ padding:28px 6vw 0 6vw; }
  .hero__brand{ font-size:var(--m-ops-fs); transform: translate(var(--m-ops-x), var(--m-ops-y)); }
  .hero__ghosts{ position:absolute; left:6vw; top:calc(6vw + 18vw); }
  .ghost-1{ font-size:var(--m-ana-fs); opacity:.96; margin:0; transform: translate(var(--m-ana-x), var(--m-ana-y)); }
  .ghost-2{ font-size:var(--m-per-fs); opacity:.25; margin-top:2.6vw; transform: translate(var(--m-per-x), var(--m-per-y)); }

  .logo-over-time{ opacity:1; }
  .logo-bg{ opacity:1; }

  .intro{
    left:6vw; right:6vw; bottom:8vh; max-width:none; text-align:center;
  }
  .intro p{ font-size:var(--m-int-fs); line-height:1.9; transform: translate(var(--m-int-x), var(--m-int-y)); }

  .divider{ top:50vh; height:74px; z-index:3600; }
  .divider::before{ left:6vw; right:6vw; top:26px; }
  .divider__grid{
    grid-template-columns: 1fr;
    gap:0;
    padding:0 6vw;
    height:74px;
    display:grid;
    align-content:flex-start;
    justify-items:center;
    position:relative;
  }

  /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙƒÙ…Ù†ÙŠÙˆ Ù…Ù†Ø¨Ø«Ù‚Ø© */
  .divider__nav{
    position:absolute;
    right:6vw;
    top:40px;
    background:rgba(15,15,26,.96);
    border-radius:12px;
    padding:8px 10px;
    box-shadow:0 12px 32px rgba(0,0,0,.5);
    display:none;
  }
  .divider__nav ul{
    flex-direction:column;
    gap:6px;
  }
  .divider__nav a{
    font-size:13px;
  }

  .divider__time{ transform: translate(var(--m-time-x), var(--m-time-y)); }

  /* Ø³Ù‡Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ */
  .divider__mobile-arrow{
    position:absolute;
    right:6vw;
    top:18px;
    width:28px;
    height:28px;
    border:none;
    background:none;
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-size:16px;
    line-height:1;
    padding:0;
  }
  .divider__mobile-arrow span{
    transition:transform .2s ease;
  }

  body.mobile-nav-open .divider__nav{
    display:block;
  }
  body.mobile-nav-open .divider__mobile-arrow span{
    transform:rotate(180deg);
  }

  .m-home{
    position:absolute;
    right:14vw;
    top:2px;
    font-size:12px;
    text-decoration:none;
    color:var(--ink);
    opacity:.85;
    display:inline;
    z-index:4200;
    transform: translate(var(--m-home-x), var(--m-home-y));
  
  /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ù† Ù„ÙˆØ­Ø© Settings) */
  .hero__brand{
    color: var(--m-ops-color, var(--accent)) !important;
    opacity: var(--m-ops-alpha, 1) !important;
  }
  .ghost-1{
    color: var(--m-ana-color, #C4C1C9) !important;
    opacity: var(--m-ana-alpha, .96) !important;
  }
  .ghost-2{
    color: var(--m-per-color, rgba(255,255,255,0.95)) !important;
    opacity: var(--m-per-alpha, 0.1) !important;
  }

  /* Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ù…Ø³ØªØ·ÙŠÙ„ ÙÙˆÙ‚ Ø§Ù„Ø®Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ */
  .logo-over-time{
    width:var(--m-logo-w);
    height:var(--m-logo-h);
    transform:
      translateX(var(--m-logo-x))
      translateY(calc(-100% - var(--m-logo-gap)) translateY(var(--m-logo-y)))
      scale(calc(var(--m-logo-scale)/100));
    transform-origin:left bottom;
  }
  .logo-bg{
    width:var(--m-rect-w);
    height:var(--m-rect-h);
    border-radius:var(--m-rect-round);
    transform:
      translate(calc(var(--m-rect-x) + var(--rect-slide-left)), var(--m-rect-y))
      scale(calc(var(--m-rect-scale)/100));
  }

  /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ù‡Ø§ØªÙ Ù„Ù„ÙˆØ¶Ø¹ÙŠÙ† Ø§Ù„ØºØ§Ù…Ù‚ ÙˆØ§Ù„ÙØ§ØªØ­ */
  :root[data-theme="dark"]{
    --bg: var(--m-bg-dark);
  }
  :root[data-theme="light"]{
    --bg: var(--m-bg-light);
  }

}}

/* ===== Ù„ÙˆØ­Ø© Settings (Mobile only) ===== */
.tuner-toggle{
  position:fixed; right:12px; bottom:12px; z-index:3800;
  width:44px; height:44px; border-radius:12px; border:1px solid var(--line);
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  display:grid; place-items:center; cursor:pointer; color:var(--ink);
}
.tuner{
  position:fixed; left:12px; right:12px; bottom:12px; z-index:3790;
  background:rgba(20,22,30,.86); -webkit-backdrop-filter: blur(10px) saturate(140%); backdrop-filter: blur(10px) saturate(140%);
  border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:12px; display:none;
}
.tuner.open{ display:block; }
.t-head{ display:grid; grid-template-columns: 220px repeat(6, 1fr); gap:8px; padding:6px 0 10px; border-bottom:1px dashed rgba(255,255,255,.08); margin-bottom:8px; font:700 11px/1 Inter; opacity:.85; text-transform:uppercase; letter-spacing:.12em; }
.t-row{ display:grid; grid-template-columns: 220px repeat(6, 1fr); gap:8px; align-items:center; margin-bottom:8px; }
.t-row .lbl{ font:600 12px/1 Inter; opacity:.9; white-space:nowrap;  text-overflow:ellipsis; }
.t-row input{ width:100%; height:34px; border:1px solid var(--line); border-radius:10px; background:transparent; color:var(--ink); padding:6px 8px; font:600 12px/1 Inter; }
.t-section{ margin-top:14px; margin-bottom:8px; font:800 12px/1 Inter; opacity:.9; letter-spacing:.08em; border-bottom:1px dotted rgba(255,255,255,.1); padding-bottom:6px; }
.t-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
.t-actions button{ border:1px solid var(--line); background:transparent; color:var(--ink); border-radius:10px; padding:8px 12px; font:700 12px/1 Inter; cursor:pointer; }
@media (max-width:980px){
  .t-row, .t-head{ grid-template-columns: 180px repeat(6, 1fr); }
@media (max-width:640px){
  /* ØªÙ†Ø¸ÙŠÙ… Ù„ÙˆØ­Ø© Settings Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ Ø­ØªÙ‰ Ù„Ø§ ØªØºØ·ÙŠ ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© */
  .tuner{
    max-height:60vh;
    overflow-y:auto;
    bottom:12px;
    left:8px;
    right:8px;
  }
  .t-head,
  .t-row{
    grid-template-columns: 140px repeat(6, 1fr);
  }
}
}

/* Added hover effects */
.divider__nav a:hover{
  transform: scale(1.1);
  color:#000 !important;
  opacity:1 !important;
  display:inline-block;
}
.divider__center:hover{
  transform: scale(1.1);
  color:#000 !important;
  opacity:1 !important;
  display:inline-block;
}


/* Dark theme hover: make hover text white */
[data-theme="dark"] .divider__nav a:hover{
  color:#fff !important;
}
[data-theme="dark"] .divider__center:hover{
  color:#fff !important;
}


/* Ensure intro text stays visible in both themes */
#introText { opacity:1 !important; color:var(--ink) !important; }



/* Ensure 'Performance' (ghost-2) visible in dark theme */
[data-theme="dark"] .ghost-2 {
  opacity: .25 !important;
  color: rgba(255,255,255,0.95) !important;
}

/* Ensure intro text visible in both themes */
#introText {
  opacity: 1 !important;
  color: var(--ink) !important;
  visibility: visible !important;
}

/* Force intro text always visible */
#introText {
  opacity: 1 !important;
  visibility: visible !important;
  color: var(--ink) !important;
}


/* Force intro always visible */
.intro, .intro p {
  opacity: 1 !important;
  visibility: visible !important;
}


/* Force intro text visible in both themes */
.intro, .intro p {
  opacity: 1 !important;
  visibility: visible !important;
}

/* Ensure intro text visible in dark theme */
[data-theme="dark"] .intro,
[data-theme="dark"] .intro p {
  color: #ffffff !important;
  opacity: 1 !important;
  visibility: visible !important;
}


/* Raise intro above background */
.intro {
  z-index: 9999 !important;
}


/* Force intro fully visible */
.intro, .intro p {
  position: relative !important;
  z-index: 99999 !important;
  opacity: 1 !important;
  visibility: visible !important;
}


/* Position intro bottom-right fixed */
.intro {
  position: fixed !important;
  right: 2vw !important;
  bottom: 2vh !important;
  left: auto !important;
  top: auto !important;
  text-align: right !important;
  width: auto !important;
  max-width: 40vw !important;
  z-index: 99999 !important;
}
.intro p {
  text-align: left !important;
}


.intro p {
  text-align: left !important;
}

[data-theme="dark"] .ghost-2 {
  opacity: 0.1 !important;
}


/* ===== Join side panel (quarter width) ===== */
.join-panel-overlay{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:flex-end;
  align-items:stretch;
  pointer-events:none;
  z-index:5000;
}
.join-panel-overlay.is-open{
  pointer-events:auto;
}
.join-panel{
  height:100vh;
  width:25vw;
  min-width:340px;
  max-width:520px;
  display:flex;
  align-items:stretch;
  justify-content:center;
  transform:translateX(100%);
  opacity:0;
  transition:transform .5s var(--ease),opacity .5s var(--ease);
}
.join-panel-overlay.is-open .join-panel{
  transform:translateX(0);
  opacity:1;
}
.join-panel__frame{
  border:none;
  width:100%;
  height:100%;
  border-radius:24px 0 0 24px;
  box-shadow:0 22px 50px rgba(15,23,42,.65);
  overflow:hidden;
  background:transparent;
}

/* Wider width only for Admin joining side panel */
#join-admin-overlay .join-panel{
  width:60vw;
  min-width:780px;
  max-width:1200px;
}
@media(max-width:960px){
  .join-panel{
    width:80vw;
    min-width:0;
  }
}


/* ===== Plane Switch (theme toggle) â€” From Uiverse.io by Nawsome ===== */
.plane-switch {
  --dot: #fff;
  --street: #6B6D76;
  --street-line: #A8AAB4;
  --street-line-mid: #C0C2C8;
  --sky-1: #60A7FA;
  --sky-2: #2F8EFC;
  --light-1: rgba(255, 233, 0, 1);
  --light-2: rgba(255, 233, 0, .3);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  display:inline-block;
}
.plane-switch input { display: none; }
.plane-switch input + div {
  -webkit-mask-image: -webkit-radial-gradient(white, black);
  position: relative;
  overflow: hidden;
  width: 50px;
  height: 25px;
  padding: 1px;
  border-radius: 13px;
  background: linear-gradient(90deg, var(--street) 0%, var(--street) 25%, var(--sky-1) 75%, var(--sky-2) 100%) left var(--p, 0%) top 0;
  background-position-x: var(--p, 0%);
  background-size: 400% auto;
  transition: background-position 0.6s;
}
.plane-switch input + div:before, .plane-switch input + div:after {
  content: "";
  display: block;
  position: absolute;
  transform: translateX(var(--s, 0));
  transition: transform 0.3s;
}
.plane-switch input + div:before {
  width: 42px;
  right: 2px;
  top: 4px;
  height: 1px;
  background: var(--street-line);
  box-shadow: 0 16px 0 0 var(--street-line);
}
.plane-switch input + div:after {
  width: 2px;
  height: 2px;
  border-radius: 50%;
  left: 23px;
  top: 1px;
  -webkit-animation: lights2 2s linear infinite;
  animation: lights2 2s linear infinite;
  box-shadow: inset 0 0 0 2px var(--light-1), 0 21px 0 var(--light-1), 8px 0 0 var(--light-2), 8px 21px 0 var(--light-2), 16px 0 0 var(--light-2), 16px 21px 0 var(--light-2);
}
.plane-switch input + div span { display: block; position: absolute; }
.plane-switch input + div span.street-middle {
  top: 12px;
  left: 21px;
  width: 3px;
  height: 1px;
  transform: translateX(var(--s, 0));
  background: var(--street-line-mid);
  box-shadow: 5px 0 0 var(--street-line-mid), 10px 0 0 var(--street-line-mid), 15px 0 0 var(--street-line-mid), 20px 0 0 var(--street-line-mid), 25px 0 0 var(--street-line-mid);
  transition: transform 0.3s;
}
.plane-switch input + div span.cloud {
  width: 12px;
  height: 4px;
  border-radius: 2px;
  background: #fff;
  position: absolute;
  top: var(--ct, 8px);
  left: 100%;
  opacity: var(--co, 0);
  transition: opacity 0.3s;
  -webkit-animation: clouds2 2s linear infinite var(--cd, 0s);
  animation: clouds2 2s linear infinite var(--cd, 0s);
}
.plane-switch input + div span.cloud:before, .plane-switch input + div span.cloud:after {
  content: "";
  position: absolute;
  transform: translateX(var(--cx, 0));
  border-radius: 50%;
  width: var(--cs, 5px);
  height: var(--cs, 5px);
  background: #fff;
  bottom: 1px;
  left: 1px;
}
.plane-switch input + div span.cloud:after { --cs: 6px; --cx: 4px; }
.plane-switch input + div span.cloud.two { --ct: 20px; --cd: 1s; opacity: var(--co-2, 0); }
.plane-switch input + div div {
  display: table;
  position: relative;
  z-index: 1;
  padding: 5px;
  border-radius: 50%;
  background: var(--dot);
  transform: translateX(var(--x, 0));
  transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.35, 1.2);
}
.plane-switch input + div div svg {
  width: 13px;
  height: 13px;
  display: block;
  color: var(--c, var(--street));
  transition: color 0.6s;
}
.plane-switch input:checked + div {
  --p: 100%;
  --x: 25px;
  --s: -50px;
  --c: var(--sky-2);
  --co: .8;
  --co-2: .6;
}
@keyframes lights2 {
  20%, 30% { box-shadow: inset 0 0 0 2px var(--light-2), 0 21px 0 var(--light-2), 8px 0 0 var(--light-1), 8px 21px 0 var(--light-1), 16px 0 0 var(--light-2), 16px 21px 0 var(--light-2); }
  55%, 65% { box-shadow: inset 0 0 0 2px var(--light-2), 0 21px 0 var(--light-2), 8px 0 0 var(--light-2), 8px 21px 0 var(--light-2), 16px 0 0 var(--light-1), 16px 21px 0 var(--light-1); }
  90%, 100% { box-shadow: inset 0 0 0 2px var(--light-1), 0 21px 0 var(--light-1), 8px 0 0 var(--light-2), 8px 21px 0 var(--light-2), 16px 0 0 var(--light-2), 16px 21px 0 var(--light-2); }
}
@keyframes clouds2 {
  97% { transform: translateX(-72px); visibility: visible; }
  98%, 100% { visibility: hidden; }
  99% { transform: translateX(-72px); }
  100% { transform: translateX(0); }
}

/* Wrapper for the toggle: no background, no border (as requested) */
.toggle-wrap{ background:transparent !important; border:none !important; }


/* Light mode: make Login/AI/Queries same color as Form */
:root[data-theme="light"] .divider__nav a.form-like{
  color: var(--muted);
  opacity: 1;
}
:root[data-theme="light"] .divider__nav a.form-like:hover{
  opacity: 1;
}


/* ===== Advanced Settings Modal (minimal patch) ===== */
.settings-modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:5000; }
.settings-modal[aria-hidden="false"]{ display:flex; }
.settings-modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.45); }
.settings-modal__panel{
  position:relative;
  width:min(720px, calc(100vw - 32px));
  max-height:min(80vh, 680px);
  overflow:auto;
  border:1px solid rgba(255,255,255,.14);
  border-radius:16px;
  background: rgba(16, 16, 24, .92);
  color: var(--ink);
  box-shadow:0 22px 50px rgba(15,23,42,.65);
  padding:18px 18px 16px;
}
:root[data-theme="light"] .settings-modal__panel{
  background: rgba(255,255,255,.92);
  color: #1b1b25;
  border:1px solid rgba(0,0,0,.10);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
}
.settings-modal__head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.settings-modal__title{ font-size:14px; letter-spacing:.08em; text-transform:uppercase; opacity:.9; }
.settings-modal__close{
  appearance:none; border:0; background:transparent; color:inherit;
  width:34px; height:34px; border-radius:10px; cursor:pointer;
  display:grid; place-items:center; opacity:.8;
}
.settings-modal__close:hover{ opacity:1; }
.settings-modal__grid{ display:grid; gap:12px; margin-top:10px; }
.settings-modal__card{
  border:1px solid rgba(255,255,255,.10);
  border-radius:14px;
  padding:12px 12px;
  background: rgba(255,255,255,.04);
}
:root[data-theme="light"] .settings-modal__card{
  border:1px solid rgba(0,0,0,.08);
  background: rgba(0,0,0,.03);
}
.settings-modal__row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.settings-modal__label{ font-size:13px; opacity:.9; }
.settings-modal__hint{ font-size:12px; opacity:.7; margin-top:6px; line-height:1.45; }
.settings-modal__action{
  appearance:none;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.06);
  color: inherit;
  border-radius:12px;
  padding:8px 10px;
  font-size:12px;
  cursor:pointer;
  opacity:.9;
}
:root[data-theme="light"] .settings-modal__action{
  border:1px solid rgba(0,0,0,.14);
  background: rgba(255,255,255,.7);
}
.settings-modal__action:hover{ opacity:1; }
.divider__nav button.form-like{
  text-decoration:none;
  color:#f5f5f5;
  opacity:.86;
  font-size:12px;
  transition:opacity .2s ease;
  padding:0;
  background:transparent;
  border:0;
  cursor:pointer;
}
.divider__nav button.form-like:hover{ opacity:1; color:#ffffff; }
:root[data-theme="light"] .divider__nav button.form-like{
  color: var(--muted);
  opacity: 1;
}


.divider__nav .nav-settings:hover{
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(0,0,0,.18);
}
.divider__nav .nav-settings:active{
  transform: translateY(0px);
  box-shadow: 0 6px 16px rgba(0,0,0,.14);
}


/* ===== Settings button UX + Click fix (final) ===== */
.form-like.nav-settings-btn{
  cursor:pointer;
  pointer-events:auto !important;
  position:relative;
  z-index:9999;
  transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;
}
.form-like.nav-settings-btn:hover{
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(0,0,0,.18);
}
.form-like.nav-settings-btn:active{
  transform: translateY(0px);
  box-shadow: 0 6px 16px rgba(0,0,0,.14);
}


/* ===== Settings Drawer (right, 25%) ===== */

/* ===== Drawer polish ===== */
.settings-drawer{
  box-shadow: -24px 0 60px rgba(0,0,0,.35);
}
.settings-drawer__head{
  padding: 16px 16px 12px;
  background: rgba(255,255,255,.06);
}
.settings-drawer__title{
  font-size: 14px;
  text-transform: none;
  letter-spacing: .2px;
}
.settings-drawer__close{
  transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;
}
.settings-drawer__body{
  padding: 16px;
}
.settings-card{
  border-radius: 18px;
}
.settings-section{
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 16px;
  background: rgba(255,255,255,.06);
  padding: 14px;
}
.settings-section h4{
  margin: 0 0 6px 0;
  font-size: 13px;
  font-weight: 900;
}
.settings-section p{
  margin: 0 0 10px 0;
  font-size: 12px;
  opacity: .85;
}
.settings-input{
  width: 100%;
  padding: 12px 14px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
  color: inherit;
  outline: none;
}
.settings-input:focus{
  border-color: rgba(255,255,255,.28);
  box-shadow: 0 0 0 4px rgba(255,255,255,.06);
}
.settings-chips{
  display:flex; gap:10px; flex-wrap:wrap; margin: 10px 0 12px;
}
.settings-chip{
  display:flex; gap:8px; align-items:center;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.10);
}
.settings-chip input{ transform: translateY(1px); }
#permSaveBtn{
  border-radius: 14px;
}
#permStatus{
  padding-top: 8px;
}
.nav-ico{
  display:inline-flex;
  width: 18px;
  justify-content:center;
  margin-right: 8px;
  opacity: .95;
}

:root{ --settings-drawer-w: min(50vw, 720px); }
body.settings-open{ padding-right: var(--settings-drawer-w); transition: padding-right .22s ease; }
.settings-drawer{
  position: fixed;
  top: 0;
  right: 0;
  width: var(--settings-drawer-w);
  height: 100vh;
  transform: translateX(100%);
  transition: transform .22s ease;
  z-index: 9998;
  border-left: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  overflow: auto;
  display: flex;
  flex-direction: column;
}
body.settings-open .settings-drawer{ transform: translateX(0); }

.settings-drawer__head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 14px 14px 10px;
  position: sticky;
  top: 0;
  background: rgba(0,0,0,.10);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,.08);
  z-index: 2;
}
.settings-drawer__title{
  display:flex; align-items:center; gap:10px;
  font-weight: 900;
}
.settings-drawer__close{
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.18);
  color: inherit;
  border-radius: 12px;
  padding: 10px 12px;
  cursor: pointer;
}
.settings-drawer__close:hover{ transform: translateY(-1px); box-shadow: 0 10px 24px rgba(0,0,0,.18); }

.settings-drawer__body{ padding: 14px; }

@media (max-width: 900px){
  :root{ --settings-drawer-w: min(88vw, 460px); }
  body.settings-open{ padding-right: 0; }
  .settings-drawer{ border-left:none; }
}


/* ===== Patch: Settings hover (no shadow) + Theme-aware drawer background ===== */
.nav-settings-btn:hover{
  box-shadow: none !important;
}

/* Drawer uses the same theme background (light/dark) without transparency */
.settings-drawer{
  background: var(--bg) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}
.settings-drawer__head{
  background: var(--bg) !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}


/* ===== Patch: Left align Analytics/Performance ===== */
.left-align-title{
  text-align: left !important;
  margin-left: 0 !important;
  margin-right: auto !important;
}


/* ===== Patch: Remove right-edge shadow until Settings Drawer opens ===== */
.settings-drawer{ box-shadow: none !important; }
body.settings-open .settings-drawer{ box-shadow: -24px 0 60px rgba(0,0,0,.35) !important; }


/* ===== Patch: User badge + dropdown (no layout changes) ===== */
.user-widget{
  position:fixed;
  top:16px;
  right:76px; /* Ø¨Ø¬Ø§Ù†Ø¨ Ø²Ø± Ø§Ù„Ø«ÙŠÙ… */
  z-index:3801;
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  user-select:none;
}
.user-badge{
  width:32px;height:32px;border-radius:999px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.18);
  display:grid;place-items:center;
  font:800 12px/1 Inter;
  color:var(--ink);
}
:root[data-theme="light"] .user-badge{
  background:rgba(0,0,0,.06);
  border:1px solid rgba(0,0,0,.12);
  color:#1d1e26;
}
.user-name{
  font:600 13px/1.2 Inter;
  color:var(--ink);
  opacity:.95;
  max-width:220px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
:root[data-theme="light"] .user-name{ color:#1d1e26; }

.user-menu{
  position:fixed;
  top:56px;
  right:16px;
  z-index:3802;
  width:260px;
  border-radius:14px;
  padding:10px;
  background:rgba(15,15,26,.96);
  border:1px solid rgba(255,255,255,.12);
  box-shadow:0 18px 40px rgba(0,0,0,.35);
  display:none;
}
:root[data-theme="light"] .user-menu{
  background:rgba(255,255,255,.96);
  border:1px solid rgba(0,0,0,.10);
  box-shadow:0 18px 40px rgba(0,0,0,.18);
}
.user-menu.open{ display:block; }
.user-menu .email{
  font:600 12px/1.2 Inter;
  opacity:.9;
  padding:8px 10px 10px;
  border-bottom:1px solid rgba(255,255,255,.10);
}
:root[data-theme="light"] .user-menu .email{ border-bottom:1px solid rgba(0,0,0,.10); }
.user-menu a, .user-menu button{
  width:100%;
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:8px;
  padding:10px 10px;
  border-radius:12px;
  border:0;
  background:transparent;
  color:inherit;
  text-decoration:none;
  cursor:pointer;
  font:700 12px/1 Inter;
  opacity:.92;
}
.user-menu a:hover, .user-menu button:hover{
  background:rgba(255,255,255,.08);
  opacity:1;
}
:root[data-theme="light"] .user-menu a:hover,
:root[data-theme="light"] .user-menu button:hover{
  background:rgba(0,0,0,.06);
}


</style>
</head>

<body>
  <!-- Ø²Ø± ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ -->
  <button class="side-toggle clickable" id="toggleSidebar" aria-label="Toggle panel">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <line x1="4" y1="6"  x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>

  <div class="layout">
    <!-- Ø§Ù„Ù„ÙˆØ­Ø© (ÙŠØ³Ø§Ø±) -->
    <aside class="sidebar" id="sidebar" aria-hidden="true">
      <div class="sidebar__header">
        <span class="sidebar__title">FORM</span>
        <button class="sidebar__close clickable" id="closeSidebar" aria-label="Close panel">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <line x1="5" y1="5" x2="19" y2="19"></line>
            <line x1="19" y1="5" x2="5" y2="19"></line>
          </svg>
        </button>
      </div>
      <div class="sidebar__content">

        <!-- Ø£Ù‚Ø³Ø§Ù… Ø¨Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ + Ø£Ø²Ø±Ø§Ø± Ø³ÙˆØ¯Ø§Ø¡ ØªØ­Øª ÙƒÙ„ Ù‚Ø³Ù… -->
        <ul class="side-list" id="sideList">

          <li class="side-h">SGS Flight Delay-FIC</li>
          <li class="side-item">
            <a href="Forms%20file/sgs_flight_delay.html">
              <svg viewBox="0 0 24 24"><polyline points="3,17 9,13 14,16 21,10"/></svg>
              sgs flight delay
            </a>
          </li>

          <li class="side-h">Operational KPIs</li>
          <li class="side-item">
            <a href="Forms%20file/shift_report.html">
              <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="12" rx="2"/></svg>
              shift report
            </a>
          </li>
          <li class="side-item">
            <a href="Forms%20file/tcc_flight_delay.html">
              <svg viewBox="0 0 24 24"><path d="M3 12h18M12 3v18"/></svg>
              tcc flight delay
            </a>
          </li>
          <li class="side-item">
            <a href="Forms%20file/operational_event.html">
              <svg viewBox="0 0 24 24"><path d="M4 17h16M6 7h12M8 11h8"/></svg>
              operational event
            </a>
          </li>

          <li class="side-h">Employee Forms</li>
          <li class="side-item">
            <a href="Forms%20file/employee_overtime.html">
              <svg viewBox="0 0 24 24"><path d="M12 6v6l4 2"/></svg>
              employee Overtime
            </a>
          </li>
          <li class="side-item">
            <a href="Forms%20file/employee_absence.html">
              <svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>
              employee absence
            </a>
          </li>
          <li class="side-item">
            <a href="Forms%20file/employee_delay.html">
              <svg viewBox="0 0 24 24"><polyline points="3,17 9,13 14,16 21,10"/></svg>
              employee delay
            </a>
          </li>
          <li class="side-item">
            <a href="Forms%20file/employee_sick_leave.html">
              <svg viewBox="0 0 24 24"><path d="M12 8v8M8 12h8"/></svg>
              employee sick leave
            </a>
          </li>

          <!-- ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
          <li class="side-h">Form</li>
          <li class="side-item">
            <!-- Technical â†’ Login -->
            <a href="Navigation panel.html">
              <svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5"/><path d="M4 12h11"/></svg>
              Login
            </a>
          </li>
          <li class="side-item">
            <!-- Baggage â†’ Login (Request to join) -->
            <a href="nxs_dashboard.html">
              <svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5"/><path d="M4 12h11"/></svg>
              Login
            </a>
          </li>

          <!-- Flight Delay â†’ Queries -->
          <li class="side-h">Employee</li>
          <li class="side-item">
            <a href="queries.html">
              <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="3"/><path d="M4 20c2-4 14-4 16 0"/></svg>
              Queries
            </a>
          </li>

        </ul>
      </div>
    </aside>

    <!-- Ø§Ù„ØµÙØ­Ø© -->
    <div class="app">
      <!-- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… -->
      <div class="toggle-wrap" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹" style="position:fixed;top:16px;right:16px;z-index:3800">
        <!-- Plane Switch (no wrapper background/border) -->
        <label class="plane-switch clickable" title="Theme">
          <input id="switch" type="checkbox" aria-label="Toggle theme">
          <div aria-hidden="true">
            <div>
              <svg viewBox="0 0 13 13">
                <path d="M1.55989957,5.41666667 L5.51582215,5.41666667 L4.47015462,0.108333333 L4.47015462,0.108333333 C4.47015462,0.0634601974 4.49708054,0.0249592654 4.5354546,0.00851337035 L4.57707145,0 L5.36229752,0 C5.43359776,0 5.50087375,0.028779451 5.55026392,0.0782711996 L5.59317877,0.134368264 L7.13659662,2.81558333 L8.29565964,2.81666667 C8.53185377,2.81666667 8.72332694,3.01067661 8.72332694,3.25 C8.72332694,3.48932339 8.53185377,3.68333333 8.29565964,3.68333333 L7.63589819,3.68225 L8.63450135,5.41666667 L11.9308317,5.41666667 C12.5213171,5.41666667 13,5.90169152 13,6.5 C13,7.09830848 12.5213171,7.58333333 11.9308317,7.58333333 L8.63450135,7.58333333 L7.63589819,9.31666667 L8.29565964,9.31666667 C8.53185377,9.31666667 8.72332694,9.51067661 8.72332694,9.75 C8.72332694,9.98932339 8.53185377,10.1833333 8.29565964,10.1833333 L7.13659662,10.1833333 L5.59317877,12.8656317 C5.55725264,12.9280353 5.49882018,12.9724157 5.43174295,12.9907056 L5.36229752,13 L4.57707145,13 L4.55610333,12.9978962 C4.51267695,12.9890959 4.48069792,12.9547924 4.47230803,12.9134397 L4.47223088,12.8704208 L5.51582215,7.58333333 L1.55989957,7.58333333 L0.891288881,8.55114605 C0.853775374,8.60544678 0.798421006,8.64327676 0.73629202,8.65879796 L0.672314689,8.66666667 L0.106844414,8.66666667 L0.0715243949,8.66058466 L0.0715243949,8.66058466 C0.0297243066,8.6457608 0.00275502199,8.60729104 0,8.5651586 L0.00593007386,8.52254537 L0.580855011,6.85813984 C0.64492547,6.67265611 0.6577034,6.47392717 0.619193545,6.28316421 L0.580694768,6.14191703 L0.00601851064,4.48064746 C0.00203480725,4.4691314 0,4.45701613 0,4.44481314 C0,4.39994001 0.0269259152,4.36143908 0.0652999725,4.34499318 L0.106916826,4.33647981 L0.672546853,4.33647981 C0.737865848,4.33647981 0.80011301,4.36066329 0.848265401,4.40322477 L0.89131128,4.45169723 L1.55989957,5.41666667 Z" fill="currentColor"></path>
              </svg>
            </div>
            <span class="street-middle"></span>
            <span class="cloud"></span>
            <span class="cloud two"></span>
          </div>
        </label>
      
</div>

      <!-- ===== User badge (top-right) ===== -->
      <div class="user-widget clickable" id="userWidget" aria-label="User menu">
        <div class="user-badge" id="userBadge">--</div>
        <div class="user-name" id="userName">Loading...</div>
      </div>

      <div class="user-menu" id="userMenu" aria-hidden="true">
        <div class="email" id="userEmail">...</div>
        <a href="Login.html" id="userMenuLogin"><span>ğŸ”</span><span>Login</span></a>
        <a href="#" id="userMenuSettings"><span>âš™ï¸</span><span>Settings</span></a>
        <a href="AI.html" id="userMenuAI"><span>ğŸ¤–</span><span>AI</span></a>
        <button type="button" id="userMenuLogout"><span>ğŸšª</span><span>Logout</span></button>
      </div>

      <!-- Hero -->
      <header class="hero" id="hero" aria-label="OPERATIONS hero">
        <div class="hero__brand">OPERATIONS</div>
        <div class="hero__ghosts" aria-hidden="true">
          <span class="ghost-1" class="left-align-title">ANALYTICS</span>
          <span class="ghost-2" class="left-align-title">PERFORMANCE</span>
        </div>

        <!-- Ø§Ù„Ø´Ø±ÙŠØ· -->
        <div class="divider" role="separator">
          <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± -->
          <div class="logo-over-time" id="logoBox" aria-hidden="false">
            <img src="https://i.postimg.cc/MTFZhMSq/14141414-removebg-preview.png" alt="Logo" />
          </div>

          <!-- Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© -->
          <div class="logo-bg" aria-hidden="true">
            <img src="https://i.postimg.cc/fTPFmWRD/image.png" alt="bg" />
          </div>

          <div class="divider__grid" id="dividerGrid">
            <div class="divider__time" id="timeEl">07:26 PST</div>

            <!-- Dashboard ÙŠÙØªØ­ Ù…Ù„Ù -->
            <a class="divider__center" id="openDashboard" href="nxs_dashboard.html" style="color:var(--ink);opacity:.62;">Dashboard</a>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„ÙˆÙŠØ©: Ø­Ø°Ù Fleet + Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ù…ÙŠØ© -->
            <nav class="divider__nav" aria-label="Primary">
              <ul>
                <li><a class="active" href="Navigation panel.html"><span class="nav-ico" aria-hidden="true">ğŸ“</span><span>Form</span></a></li>
                <li><a id="openSettingsDrawer" class="form-like nav-settings-btn" href="#" title="Settings"><span class="nav-ico" aria-hidden="true">âš™ï¸</span><span>Settings</span></a></li>
                <li><a class="form-like" href="AI.html" id="navAI"><span class="nav-ico" aria-hidden="true">ğŸ¤–</span><span>AI</span></a></li>
</ul>
            </nav>

            <!-- Ø³Ù‡Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ) -->
            <button class="divider__mobile-arrow m-arrow" id="dividerMobileArrow" aria-label="Toggle navigation" aria-expanded="false">
              <span>â–¾</span>
            </button>

            <!-- Ø§Ù„Ù‡Ø§ØªÙ: Home ÙÙ‚Ø· (Ø£Ø²Ù„Ù†Ø§ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø®Ø±Ù‰) -->
            <a href="Login.html" class="m-home clickable" aria-label="Home" style="display:none">Login</a>
          </div>
        </div>
      </header>

      <main>
        <section class="intro" aria-label="Company intro">
          <p id="introText">
Empowering OPERATIONS through clarity, analytical precision, and measurable impact â€”
via integrated data and interactive dashboards that link OPERATIONS to results.
          </p>
        </section>
      </main>
    </div>
  </div>


  <!-- ===== Join side panel overlay (joining) ===== -->
  <div class="join-panel-overlay" id="join-panel-overlay" aria-hidden="true">
    <div class="join-panel">
      <iframe src="joining.html" class="join-panel__frame" title="Join NXS"></iframe>
    </div>
  </div>


<!-- ===== Admin join side panel overlay (joining_admin) ===== -->
<div class="join-panel-overlay" id="join-admin-overlay" aria-hidden="true">
  <div class="join-panel">
    <iframe src="joining_admin.html" class="join-panel__frame" title="Admin joining"></iframe>
  </div>
</div>

<!-- ===== Ù„ÙˆØ­Ø© Settings â€” Ù„Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø· ===== -->
<button class="tuner-toggle" id="tunerToggle" title="Settings">âš™ï¸</button>
<div class="tuner" id="tuner">

  <div class="t-head">
    <div>Ø§Ù„Ø¹Ù†ØµØ±</div>
    <div>X (Ø§Ù„Ø¥Ø²Ø§Ø­Ø©)</div>
    <div>Y (Ø§Ù„Ø¥Ø²Ø§Ø­Ø©)</div>
    <div>Ø­Ø¬Ù… Ø§Ù„Ø®Ø·/Ø§Ù„Ø­Ø¬Ù…</div>
    <div>Ø§Ù„Ø¹Ø±Ø¶</div>
    <div>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ / Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø±</div>
    <div>Ø£Ø®Ø±Ù‰</div>
  </div>

  <div class="t-section">Ø§Ù„Ù‡Ø§ØªÙ â€” Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†</div>
  <div class="t-row">
    <div class="lbl">OPERATIONS (X,Y, Ø­Ø¬Ù… Ø®Ø·)</div>
    <input data-var="--m-ops-x" data-unit="vw" type="number" step="0.1" placeholder="X vw">
    <input data-var="--m-ops-y" data-unit="vh" type="number" step="0.1" placeholder="Y vh">
    <input data-var="--m-ops-fs" data-unit="vw" type="number" step="0.1" placeholder="Fs vw">
    <input data-var="--m-ops-color" type="text" placeholder="# Ù„ÙˆÙ† OPERATIONS">
    <input data-var="--m-ops-alpha" type="number" step="0.05" min="0" max="1" placeholder="Ø´ÙØ§ÙÙŠØ© 0â€“1">
    <div></div>
  </div>
  <div class="t-row">
    <div class="lbl">ANALYTICS (X,Y, Ø­Ø¬Ù… Ø®Ø·)</div>
    <input data-var="--m-ana-x" data-unit="vw" type="number" step="0.1" placeholder="X vw">
    <input data-var="--m-ana-y" data-unit="vh" type="number" step="0.1" placeholder="Y vh">
    <input data-var="--m-ana-fs" data-unit="vw" type="number" step="0.1" placeholder="Fs vw">
    <input data-var="--m-ana-color" type="text" placeholder="# Ù„ÙˆÙ† ANALYTICS">
    <input data-var="--m-ana-alpha" type="number" step="0.05" min="0" max="1" placeholder="Ø´ÙØ§ÙÙŠØ© 0â€“1">
    <div></div>
  </div>
  <div class="t-row">
    <div class="lbl">PERFORMANCE (X,Y, Ø­Ø¬Ù… Ø®Ø·)</div>
    <input data-var="--m-per-x" data-unit="vw" type="number" step="0.1" placeholder="X vw">
    <input data-var="--m-per-y" data-unit="vh" type="number" step="0.1" placeholder="Y vh">
    <input data-var="--m-per-fs" data-unit="vw" type="number" step="0.1" placeholder="Fs vw">
    <input data-var="--m-per-color" type="text" placeholder="# Ù„ÙˆÙ† PERFORMANCE">
    <input data-var="--m-per-alpha" type="number" step="0.05" min="0" max="1" placeholder="Ø´ÙØ§ÙÙŠØ© 0â€“1">
    <div></div>
  </div>

  <div class="t-section">Ø§Ù„Ù‡Ø§ØªÙ â€” Ø§Ù„Ø´Ø±ÙŠØ·</div>
  <div class="t-row">
    <div class="lbl">Ø§Ù„ÙˆÙ‚Øª 07:26 PST (X,Y)</div>
    <input data-var="--m-time-x" data-unit="px" type="number" step="1" placeholder="X px">
    <input data-var="--m-time-y" data-unit="px" type="number" step="1" placeholder="Y px">
    <input disabled placeholder="â€”">
    <div></div><div></div><div></div>
  </div>
  <div class="t-row">
    <div class="lbl">Home (Ø²Ø± Ø§Ù„Ù‡Ø§ØªÙ) (X,Y)</div>
    <input data-var="--m-home-x" data-unit="px" type="number" step="1" placeholder="X px">
    <input data-var="--m-home-y" data-unit="px" type="number" step="1" placeholder="Y px">
    <input disabled placeholder="â€”">
    <div></div><div></div><div></div>
  </div>

  <div class="t-section">Ø§Ù„Ù‡Ø§ØªÙ â€” Ù…Ø±Ø¨Ø¹ Ø§Ù„ØµÙˆØ±Ø© (Ø§Ù„Ø´Ø¹Ø§Ø±)</div>
  <div class="t-row">
    <div class="lbl">Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø±</div>
    <input data-var="--m-logo-x" data-unit="vw"  type="number" step="0.1" placeholder="X vw">
    <input data-var="--m-logo-y" data-unit="vh"  type="number" step="0.1" placeholder="Y vh">
    <input data-var="--m-logo-scale"           type="number" step="1"   placeholder="Ø§Ù„Ø­Ø¬Ù… %">
    <input data-var="--m-logo-w" data-unit="px" type="number" step="1"   placeholder="Ø§Ù„Ø¹Ø±Ø¶ px">
    <input data-var="--m-logo-h" data-unit="px" type="number" step="1"   placeholder="Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ px">
    <input data-var="--m-logo-gap" data-unit="px" type="number" step="1" placeholder="Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø®Ø·">
  </div>

  <div class="t-section">Ø§Ù„Ù‡Ø§ØªÙ â€” Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø®Ù„Ù Ø§Ù„Ø´Ø¹Ø§Ø±</div>
  <div class="t-row">
    <div class="lbl">Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„</div>
    <input data-var="--m-rect-x" data-unit="vw"  type="number" step="0.1" placeholder="X vw">
    <input data-var="--m-rect-y" data-unit="vh"  type="number" step="0.1" placeholder="Y vh">
    <input data-var="--m-rect-scale"           type="number" step="1"   placeholder="Ø§Ù„Ø­Ø¬Ù… %">
    <input data-var="--m-rect-w" data-unit="vw" type="number" step="0.1" placeholder="Ø§Ù„Ø¹Ø±Ø¶ vw">
    <input data-var="--m-rect-h" data-unit="vw" type="number" step="0.1" placeholder="Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ vw">
    <input data-var="--m-rect-round" data-unit="px" type="number" step="1" placeholder="Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± px">
  </div>

  <div class="t-section">Ø§Ù„Ù‡Ø§ØªÙ â€” Ø§Ù„Ù†Øµ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ</div>
  <div class="t-row">
    <div class="lbl">Intro Text (ØªÙ… ØªØ«Ø¨ÙŠØªÙ‡ ÙˆØªÙˆØ³ÙŠØ·Ù‡)</div>
    <input data-var="--m-int-x" data-unit="px" type="number" step="1" placeholder="X px">
    <input data-var="--m-int-y" data-unit="px" type="number" step="1" placeholder="Y px">
    <input data-var="--m-int-fs" data-unit="px" type="number" step="1" placeholder="Ø§Ù„Ø­Ø¬Ù… px">
    <div></div><div></div><div></div>
  </div>

  <div class="t-section">Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ù‡Ø§ØªÙ)</div>
  <div class="t-row">
    <div class="lbl">Ø®Ù„ÙÙŠØ© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØºØ§Ù…Ù‚ / Ø§Ù„ÙØ§ØªØ­</div>
    <input data-var="--m-bg-dark" type="text" placeholder="# Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ØºØ§Ù…Ù‚">
    <input data-var="--m-bg-light" type="text" placeholder="# Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ§ØªØ­">
    <input disabled placeholder="â€”">
    <div></div><div></div><div></div>
  </div>

  <div class="t-actions">
    <button id="tClose" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
/* ===== OAP Stable Gate (NO Supabase Auth dependency) =====
   Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§ ØªÙÙØªØ­ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­ Ù…Ù† Login.html
   Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¬Ù„Ø³Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙŠ ØªÙÙ†Ø´Ø£ ÙÙŠ Login.html:
   - sessionStorage: oap_session_v1  (Ù…ÙÙØ¶Ù„)
   - Ø£Ùˆ localStorage: isLoggedIn=1  (Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
*/
(function () {
  function safeJsonParse(s){ try { return JSON.parse(s); } catch(e){ return null; } }

  function getOapSession(){
    const ss = sessionStorage.getItem("oap_session_v1");
    if (ss) {
      const obj = safeJsonParse(ss);
      if (obj && obj.expires_at && Date.now() > Number(obj.expires_at)) {
        // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©
        sessionStorage.removeItem("oap_session_v1");
        sessionStorage.removeItem("oap_home_gate_v1");
        sessionStorage.removeItem("isLoggedIn");
        localStorage.removeItem("isLoggedIn");
        return null;
      }
      return obj || { v: 1 };
    }
    // fallback (Ø£Ø¶Ø¹Ù): isLoggedIn
    if (localStorage.getItem("isLoggedIn") === "1" || sessionStorage.getItem("isLoggedIn") === "1") {
      return { v: 1, role: localStorage.getItem("oap_role") || null };
    }
    return null;
  }

  const sess = getOapSession();
  if (!sess) {
    // ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ ÙˆØ«Ø§Ø¨Øª
    window.location.replace("Login.html");
    return;
  }

  // ===== Menu permissions (minimal + stable) =====
  // NOTE: Ø·Ø§Ù„Ù…Ø§ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Supabase AuthØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… auth.uid() Ù‡Ù†Ø§.
  // Ù„Ø°Ù„Ùƒ Ù†Ø³ØªØ®Ø¯Ù… role Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Login RPC (Ù…Ø«Ø§Ù„: Administrator / Manager / Supervisor / Employee).
  const role = (sess && sess.role) ? String(sess.role) : (localStorage.getItem("oap_role") || "");

  const elDashboard = document.getElementById("openDashboard");
  const elSettings  = document.getElementById("navSettings");
  const elAI        = document.getElementById("navAI");

  function hide(el){ if(el) el.style.display = "none"; }
  function show(el){ if(el) el.style.display = ""; }

  // Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ù†Ø®ÙÙŠ
  hide(elDashboard); hide(elSettings); hide(elAI);

  // ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± (Ù…Ø´Ø¯Ù‘Ø¯Ø© + Ù…Ø±Ù†Ø©):
  // 1) Ø¥Ø°Ø§ role ØªÙØ´ÙŠØ± Ù„Ø£Ø¯Ù…Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ/Ø¹Ø±Ø¨ÙŠ) â†’ Ù…Ø³Ù…ÙˆØ­
  // 2) Ø£Ùˆ Ø¥Ø°Ø§ Employee ID Ø¶Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ/Ø§Ù„Ø£Ø¯Ù…Ù† â†’ Ù…Ø³Ù…ÙˆØ­
  const normRole = String(role || "").trim().toLowerCase();

  const adminRoleKeywords = [
    "administrator", "admin", "owner", "super admin",
    "Ù…Ø¯ÙŠØ±", "Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…", "Ø§Ø¯Ù…Ù†", "Ø£Ø¯Ù…Ù†", "Ù…Ø´Ø±Ù", "Ù…Ø³Ø¤ÙˆÙ„"
  ];

  // Ø¶Ø¹ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡Ù… ÙƒØ£Ø¯Ù…Ù† Ù‡Ù†Ø§ (Ø§Ù„Ù…Ø§Ù„Ùƒ + Ø£ÙŠ Ø£Ø¯Ù…Ù† Ø¢Ø®Ø±)
  // Ù…Ø«Ø§Ù„: const adminEmployeeIds = ["15013814", "15000654"];
  const adminEmployeeIds = ["15013814"];

  const employeeId = (sess && sess.employee_id) ? String(sess.employee_id) : (localStorage.getItem("oap_employee_id") || "");

  const isAdminByRole = adminRoleKeywords.some(k => normRole.includes(k));
  const isAdminById   = adminEmployeeIds.includes(String(employeeId).trim());

  if (isAdminByRole || isAdminById) {
    show(elDashboard); show(elSettings); show(elAI);
  }
})();
</script>


<script>
/* ===== Patch: Show employee name + dropdown menu (uses existing OAP session) ===== */
(function(){
  function safeJsonParse(s){ try { return JSON.parse(s); } catch(e){ return null; } }
  function initials(name){
    const s = String(name || "").trim();
    if(!s) return "--";
    const parts = s.split(/\s+/);
    const a = parts[0] && parts[0][0] ? parts[0][0] : "";
    const b = parts[1] && parts[1][0] ? parts[1][0] : (parts[0] && parts[0][1] ? parts[0][1] : "");
    return ((a + b).toUpperCase()) || "--";
  }

  const w = document.getElementById('userWidget');
  const badge = document.getElementById('userBadge');
  const nameEl = document.getElementById('userName');
  const menu = document.getElementById('userMenu');
  const emailEl = document.getElementById('userEmail');
  const btnLogout = document.getElementById('userMenuLogout');
  const btnSettings = document.getElementById('userMenuSettings');

  if(!w || !badge || !nameEl || !menu || !emailEl) return;

  const sessRaw = sessionStorage.getItem('oap_session_v1');
  const sess = sessRaw ? safeJsonParse(sessRaw) : null;

  const fallbackEmail = (sess && sess.email) ? String(sess.email) : (localStorage.getItem('oap_email') || '');
  const fallbackName  = (sess && (sess.employee_name || sess.employeeName)) ? (sess.employee_name || sess.employeeName) : '';
  const userId        = (sess && (sess.user_id || sess.userId)) ? String(sess.user_id || sess.userId) : '';
  const employeeId    = (sess && (sess.employee_id || sess.employeeId)) ? String(sess.employee_id || sess.employeeId) : (localStorage.getItem('oap_employee_id') || '');

  function setUI(displayName, email){
    nameEl.textContent = displayName || email || 'User';
    badge.textContent = initials(displayName || email);
    emailEl.textContent = email || 'â€”';
  }

  function openMenu(){
    menu.classList.add('open');
    menu.setAttribute('aria-hidden','false');
  }
  function closeMenu(){
    menu.classList.remove('open');
    menu.setAttribute('aria-hidden','true');
  }

  w.addEventListener('click', function(e){
    e.stopPropagation();
    if(menu.classList.contains('open')) closeMenu(); else openMenu();
  });
  document.addEventListener('click', function(){ closeMenu(); });
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeMenu(); });

  if(btnSettings){
    btnSettings.addEventListener('click', function(e){
      e.preventDefault();
      closeMenu();
      const openBtn = document.getElementById('openSettingsDrawer');
      if(openBtn){ openBtn.click(); return; }
    });
  }

  if(btnLogout){
    btnLogout.addEventListener('click', function(){
      try{
        sessionStorage.removeItem('oap_session_v1');
        sessionStorage.removeItem('oap_home_gate_v1');
        sessionStorage.removeItem('isLoggedIn');
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('oap_role');
        localStorage.removeItem('oap_employee_id');
        localStorage.removeItem('oap_email');
      }catch(err){}
      window.location.replace('Login.html');
    });
  }

  if(fallbackName || fallbackEmail){
    setUI(fallbackName, fallbackEmail);
  } else {
    setUI('Loading...', '');
  }

  const SUPABASE_URL = "https://inuqlhkoaoeiycefvjyj.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImludXFsaGtvYW9laXljZWZ2anlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMTUxODEsImV4cCI6MjA3ODY5MTE4MX0.DCAY9rN0noaBoE_T-6eDsb_79szK91af989f9TqjEow";

  function getClient(){
    if(window.__sbClient) return window.__sbClient;
    if(window.supabase && window.supabase.createClient){
      const c = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      window.__sbClient = c;
      return c;
    }
    return null;
  }

  async function loadProfile(){
    const sb = getClient();
    if(!sb) return;

    try{
      let q = sb.from('users_with_employee_view').select('user_id,email,"Employee Name"');

      if(fallbackEmail){
        q = q.eq('email', fallbackEmail);
      } else if(userId){
        q = q.eq('user_id', userId);
      } else if(employeeId){
        q = q.eq('employee_id', employeeId);
      } else {
        return;
      }

      const { data } = await q.maybeSingle();
      if(!data) return;

      const dn = data["Employee Name"] || fallbackName || data.email || fallbackEmail;
      const em = data.email || fallbackEmail;

      try{
        const newSess = Object.assign({}, sess || {});
        if(em) newSess.email = em;
        if(dn) newSess.employee_name = dn;
        if(data.user_id) newSess.user_id = data.user_id;
        sessionStorage.setItem('oap_session_v1', JSON.stringify(newSess));
      }catch(err){}

      setUI(dn, em);
    }catch(err){}
  }

  setTimeout(loadProfile, 0);
})();
</script>




<script>
/* Ù„Ù…Ø³Ø©/Ù†Ù‚Ø±Ø© Ø³Ø±ÙŠØ¹Ø© */
function onTap(el, fn){
  if(!el) return;
  let lock=false;
  function fire(e){ if(lock) return; lock=true; setTimeout(()=>lock=false,80);
    if(e && e.type!=='click' && e.cancelable) e.preventDefault();
    fn(e);
  }
  el.addEventListener('pointerup', fire, {passive:false});
  el.addEventListener('click', fire, false);
}

(function(){
  /* Ø§Ù„Ø«ÙŠÙ… */
  const root=document.documentElement, cb=document.getElementById('switch');
  const KEY='pref-theme', saved=localStorage.getItem(KEY);
  const initial = saved || (matchMedia('(prefers-color-scheme: light)').matches ? 'light':'dark');
  root.setAttribute('data-theme', initial);
  if(cb){ cb.checked=(initial==='light'); cb.addEventListener('change', ()=>{ root.setAttribute('data-theme', cb.checked?'light':'dark'); localStorage.setItem(KEY, cb.checked?'light':'dark'); }); }

  /* Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± */
  onTap(document.getElementById('toggleSidebar'), ()=> document.body.classList.toggle('sidebar-open'));
  onTap(document.getElementById('closeSidebar'),  ()=> document.body.classList.remove('sidebar-open'));

  /* Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ù…Ø¹ Ø§Ù„ÙˆÙ‚Øª (Desktop baseline) */
  const logo=document.getElementById('logoBox');
  const timeEl=document.getElementById('timeEl');
  const divider=document.querySelector('.divider');
  function alignLogoLeft(){
    if(!logo||!timeEl||!divider) return;
    const rt=timeEl.getBoundingClientRect(); const rd=divider.getBoundingClientRect();
    logo.style.left = (rt.left - rd.left) + 'px';
  }
  window.addEventListener('load', alignLogoLeft, {once:true});
  window.addEventListener('resize', alignLogoLeft);
  setTimeout(alignLogoLeft,100);

  /* Ù„ÙˆØ­Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ */
  const tuner = document.getElementById('tuner');
  const tToggle = document.getElementById('tunerToggle');
  const tClose = document.getElementById('tClose');
  const STORE_KEY = 'AK_tune_mobile';

  function parseUnitVal(val, unit){
    if(!val) return '';
    if(unit && val.endsWith(unit)) return parseFloat(val.replace(unit,''));
    const num = parseFloat(val); return isNaN(num) ? '' : num;
  }
  function loadIntoInputs(){
    tuner.querySelectorAll('input[data-var]').forEach(inp=>{
      const v = getComputedStyle(root).getPropertyValue(inp.dataset.var).trim();
      const unit = inp.dataset.unit||'';
      inp.value = parseUnitVal(v, unit);
    });
  }
  function applyVar(name, valueWithUnit){ root.style.setProperty(name, valueWithUnit); }
  function saveAll(){
    const out = {};
    tuner.querySelectorAll('input[data-var]').forEach(inp=>{
      const name=inp.dataset.var, unit=inp.dataset.unit||'', val=inp.value===''?'':(inp.value+unit);
      if(val!=='') out[name]=val;
    });
    localStorage.setItem(STORE_KEY, JSON.stringify(out));
  }
  function restoreAll(){
    const raw=localStorage.getItem(STORE_KEY); if(!raw) return;
    try{ const obj=JSON.parse(raw); Object.keys(obj).forEach(k=>applyVar(k,obj[k])); }catch(e){}
  }

  onTap(tToggle, ()=>{ tuner.classList.add('open'); loadIntoInputs(); });
  onTap(tClose, ()=> tuner.classList.remove('open'));
  tuner.addEventListener('input', function(e){
    const inp=e.target; if(!inp.matches('input[data-var]')) return;
    const name=inp.dataset.var, unit=inp.dataset.unit||'';
    if(inp.value==='') return;
    applyVar(name, inp.value+unit); saveAll();
  });

  restoreAll();
})();

/* ===== Settings Modal logic (minimal patch) ===== */
(function(){
  const openBtn = document.getElementById('openSettings');
  const modal = document.getElementById('settingsModal');
  const closeBtn = document.getElementById('closeSettings');
  const backdrop = modal ? modal.querySelector('[data-close="1"]') : null;

  function openModal(){
    if(!modal) return;
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden','false');
    // focus close button for accessibility
    setTimeout(()=>{ closeBtn && closeBtn.focus(); }, 0);
  }
  function closeModal(){
    if(!modal) return;
    modal.setAttribute('aria-hidden','true');
    modal.style.display = 'none';
    setTimeout(()=>{ openBtn && openBtn.focus(); }, 0);
  }

  openBtn && openBtn.addEventListener('click', openModal);
  closeBtn && closeBtn.addEventListener('click', closeModal);
  backdrop && backdrop.addEventListener('click', closeModal);

  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && modal && modal.getAttribute('aria-hidden') === 'false'){
      closeModal();
    }
  });

  // Settings actions
  const toggleThemeBtn = document.getElementById('settingsToggleTheme');
  const hiddenThemeSwitch = document.getElementById('switch'); // existing theme checkbox
  toggleThemeBtn && toggleThemeBtn.addEventListener('click', ()=>{
    if(hiddenThemeSwitch){
      hiddenThemeSwitch.checked = !hiddenThemeSwitch.checked;
      hiddenThemeSwitch.dispatchEvent(new Event('change', {bubbles:true}));
    }
  });

  const clearCacheBtn = document.getElementById('settingsClearCache');
  clearCacheBtn && clearCacheBtn.addEventListener('click', ()=>{
    try{
      localStorage.removeItem('theme');
      localStorage.removeItem('nxs_theme');
    }catch(err){}
    // keep current theme, just confirm action silently by quick close/open flash
    closeModal();
  });

  const aboutBtn = document.getElementById('settingsAbout');
  aboutBtn && aboutBtn.addEventListener('click', ()=>{
    alert('NXS â€” Advanced Settings\n\nâ€¢ Theme toggle\nâ€¢ Cache clear\n\n(You can customize this modal content as needed.)');
  });
})();

</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js');
    });
  }
</script>


<script>
function updateTime(){
  const el=document.getElementById('timeEl');
  if(!el) return;
  const d=new Date();
  const opts={day:'2-digit', month:'long', year:'numeric'};
  el.textContent=d.toLocaleDateString('en-US', opts);
}
updateTime();
setInterval(updateTime,60000);

// Ø³Ù‡Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
(function(){
  const arrow = document.getElementById('dividerMobileArrow');
  const nav = document.querySelector('.divider__nav');
  if(!arrow || !nav) return;

  arrow.addEventListener('click', function(e){
    e.preventDefault();
    document.body.classList.toggle('mobile-nav-open');
    const open = document.body.classList.contains('mobile-nav-open');
    arrow.setAttribute('aria-expanded', open ? 'true' : 'false');
  });
})();
</script>


<script>
(function(){
  const overlay = document.getElementById('join-panel-overlay');
  if(!overlay) return;

  function openJoinPanel(){
    overlay.classList.add('is-open');
    overlay.setAttribute('aria-hidden','false');
  }
  function closeJoinPanel(){
    overlay.classList.remove('is-open');
    overlay.setAttribute('aria-hidden','true');
  }

  // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù„ÙˆØ­Ø©
  overlay.addEventListener('click', function(e){
    if(e.target === overlay){ closeJoinPanel(); }
  });

  // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Esc
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){ closeJoinPanel(); }
  });

  // Ø±Ø¨Ø· Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ joining ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ø¨Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  const navLinks = document.querySelectorAll('.divider__nav a');
  navLinks.forEach(function(a){
    const href = (a.getAttribute('href') || '').toLowerCase();
    if(href.indexOf('joining.html') !== -1){
      a.addEventListener('click', function(ev){
        ev.preventDefault();
        openJoinPanel();
      });
    }
  });

  // Ø¥ØªØ§Ø­Ø© Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø¥Ù† Ù„Ø²Ù… (Ù…Ø«Ù„Ø§Ù‹ Ù…Ù† Ø²Ø± Ø¢Ø®Ø±)
  window.NXSJoinPanel = { open: openJoinPanel, close: closeJoinPanel };
})();
</script>


<script>
(function(){
  const overlay = document.getElementById('join-admin-overlay');
  if (!overlay) return;

  function openAdminPanel(){
    overlay.classList.add('is-open');
    overlay.setAttribute('aria-hidden', 'false');
  }
  function closeAdminPanel(){
    overlay.classList.remove('is-open');
    overlay.setAttribute('aria-hidden', 'true');
  }

  // Close when clicking outside the panel
  overlay.addEventListener('click', function(e){
    if (e.target === overlay){
      closeAdminPanel();
    }
  });

  // Close on Esc key
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape'){
      closeAdminPanel();
    }
  });

  // Link "Admin joining" in the top nav to this side panel
  const navLinks = document.querySelectorAll('.divider__nav a');
  navLinks.forEach(function(a){
    const href = (a.getAttribute('href') || '').toLowerCase();
    if (href.indexOf('joining_admin.html') !== -1){
      a.addEventListener('click', function(ev){
        ev.preventDefault();
        openAdminPanel();
      });
    }
  });

  // Expose for manual use if ever needed
  window.NXSAdminJoinPanel = { open: openAdminPanel, close: closeAdminPanel };
})();
</script>


<!-- ===== Advanced Settings Modal ===== -->
<div class="settings-modal" id="settingsModal" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Advanced settings">
  <div class="settings-modal__backdrop" data-close="1" aria-hidden="true"></div>
  <div class="settings-modal__panel" role="document">
    <div class="settings-modal__head">
      <div>
        <div class="settings-modal__title">Advanced Settings</div>
      </div>
      <button class="settings-modal__close" type="button" id="closeSettings" aria-label="Close">âœ•</button>
    </div>

    <div class="settings-modal__grid">
      <div class="settings-modal__card">
        <div class="settings-modal__row">
          <div class="settings-modal__label">Theme</div>
          <button class="settings-modal__action" type="button" id="settingsToggleTheme">Toggle</button>
        </div>
        <div class="settings-modal__hint">Use the existing theme toggle logic â€” this button just triggers it.</div>
      </div>

      <div class="settings-modal__card">
        <div class="settings-modal__row">
          <div class="settings-modal__label">Cache</div>
          <button class="settings-modal__action" type="button" id="settingsClearCache">Clear</button>
        </div>
        <div class="settings-modal__hint">Clears local saved theme + UI state (if any).</div>
      </div>

      <div class="settings-modal__card">
        <div class="settings-modal__row">
          <div class="settings-modal__label">About</div>
          <button class="settings-modal__action" type="button" id="settingsAbout">Info</button>
        </div>
        <div class="settings-modal__hint">Shows build info and quick help.</div>
      </div>
    </div>
  </div>
</div>


<script>
/* ===== Admin permissions UI (calls DB RPC) =====
   ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ RPC: public.admin_set_page_access
   ÙˆÙŠØªØ·Ù„Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Admin Ø¯Ø§Ø®Ù„ public.users (app_role='admin') ÙˆÙ…ÙØ³Ø¬Ù‘Ù„ Ø¹Ø¨Ø± Supabase Auth.
*/
(function(){
  const SUPABASE_URL = "https://inuqlhkoaoeiycefvjyj.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImludXFsaGtvYW9laXljZWZ2anlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMTUxODEsImV4cCI6MjA3ODY5MTE4MX0.DCAY9rN0noaBoE_T-6eDsb_79szK91af989f9TqjEow";

  if(!window.supabase) return;
  const sb = window.__sbClient || window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.__sbClient = sb;

  const box = document.getElementById('adminPermBox');
  const emailEl = document.getElementById('permEmail');
  const sEl = document.getElementById('permSettings');
  const aEl = document.getElementById('permAI');
  const dEl = document.getElementById('permDashboard');
  const btn = document.getElementById('permSaveBtn');
  const status = document.getElementById('permStatus');

  function setMsg(msg, ok){
    if(!status) return;
    status.textContent = msg || "";
    status.style.color = ok ? "#22c55e" : "#ef4444";
  }

  async function ensureAuth(){
    const { data: { session } } = await sb.auth.getSession();
    return session;
  }

  async function isAdmin(){
    const { data, error } = await sb.rpc('is_admin');
    if(error) return false;
    return data === true;
  }

  async function setOne(pageKey, canAccess){
    const { error } = await sb.rpc('admin_set_page_access', {
      p_target_email: (emailEl.value || "").trim(),
      p_page_key: pageKey,
      p_can_access: !!canAccess
    });
    if(error) throw error;
  }

  async function init(){
    const session = await ensureAuth();
    if(!session){ if(box) box.style.display='none'; return; }
    const ok = await isAdmin();
    if(!ok){ if(box) box.style.display='none'; return; }

    if(btn){
      btn.addEventListener('click', async () => {
        const email = ((emailEl && emailEl.value) || "").trim();
        if(!email) { setMsg("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹.", false); return; }

        btn.disabled = true;
        setMsg("Ø¬Ø§Ø±Ù Save Permissions...", true);

        try {
          await setOne('settings', sEl && sEl.checked);
          await setOne('ai', aEl && aEl.checked);
          await setOne('dashboard', dEl && dEl.checked);
          setMsg("ØªÙ… Save Permissions Ø¨Ù†Ø¬Ø§Ø­ âœ…", true);
        } catch(e) {
          console.error(e);
          setMsg("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ£Ù†Ùƒ Admin.", false);
        } finally {
          btn.disabled = false;
        }
      });
    }
  }

  if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>





<!-- ===== Settings Drawer (panel) ===== -->
<aside id="settingsDrawer" class="settings-drawer" aria-hidden="true">
  <div class="settings-drawer__head">
    <div class="settings-drawer__title"><span aria-hidden="true">âš™ï¸</span><span>Settings</span></div>
    <button id="closeSettingsDrawer" class="settings-drawer__close" type="button">âœ•</button>
  </div>

  <div class="settings-drawer__body">

    <div class="settings-section">
      <h4>Admin Session</h4>
      <p>To manage permissions securely, sign in with your <b>Supabase Auth</b> admin account.</p>

      <div id="adminSessionSignedOut">
        <input id="adminEmail" class="settings-input" type="email" placeholder="Admin email" style="margin-bottom:10px;">
        <input id="adminPass" class="settings-input" type="password" placeholder="Admin password" style="margin-bottom:10px;">
        <button id="adminSignInBtn" class="btn primary" style="width:100%;">Sign in</button>
        <div id="adminAuthStatus" style="margin-top:10px; font-size:12px; opacity:.9;"></div>
      </div>

      <div id="adminSessionSignedIn" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
          <div style="font-size:12px; opacity:.9;">
            Signed in as: <b id="adminWho"></b>
          </div>
          <button id="adminSignOutBtn" class="settings-drawer__close" type="button">Sign out</button>
        </div>
        <div id="adminAuthStatus2" style="margin-top:10px; font-size:12px; opacity:.9;"></div>
      </div>
    </div>

    <div class="settings-section" style="margin-top:14px;">
      <h4>Grant / Update Permissions</h4>
      <p>Enter an <b>Employee ID</b>, choose allowed pages, then save.</p>

      <input id="permEmployeeId" class="settings-input" inputmode="numeric" placeholder="Employee ID">

      <div class="settings-chips">
        <label class="settings-chip"><input id="permSettings" type="checkbox"><span>Settings</span></label>
        <label class="settings-chip"><input id="permAI" type="checkbox"><span>AI</span></label>
        <label class="settings-chip"><input id="permDashboard" type="checkbox"><span>Dashboard</span></label>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button id="permLoadBtn" class="btn" style="flex:1;">Load</button>
        <button id="permSaveBtn" class="btn primary" style="flex:1;">Save</button>
      </div>

      <div id="permStatus" style="margin-top:10px; font-size:12px; opacity:.9;"></div>
    </div>

    <div class="settings-section" style="margin-top:14px;">
      <h4>Users with Access</h4>
      <p>Review, edit, or revoke page permissions.</p>

      <input id="permSearch" class="settings-input" placeholder="Search by email or employee id" style="margin-bottom:10px;">

      <div style="overflow:auto; border-radius:14px; border:1px solid rgba(255,255,255,.10);">
        <table style="width:100%; border-collapse:collapse; font-size:12px;">
          <thead style="background: rgba(255,255,255,.06);">
            <tr>
              <th style="text-align:left; padding:10px;">Employee</th>
              <th style="text-align:left; padding:10px;">Email</th>
              <th style="text-align:center; padding:10px;">Settings</th>
              <th style="text-align:center; padding:10px;">AI</th>
              <th style="text-align:center; padding:10px;">Dashboard</th>
              <th style="text-align:right; padding:10px;">Actions</th>
            </tr>
          </thead>
          <tbody id="permTableBody"></tbody>
        </table>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px;">
        <button id="permRefreshBtn" class="btn" style="flex:1;">Refresh</button>
      </div>

      <div id="permListStatus" style="margin-top:10px; font-size:12px; opacity:.9;"></div>
    </div>

  </div>
</aside>




<script>
/* ===== Settings Drawer (Advanced) ===== */
(function(){
  const drawer = document.getElementById('settingsDrawer');
  const openBtn = document.getElementById('openSettingsDrawer');
  const closeBtn = document.getElementById('closeSettingsDrawer');

  function openDrawer(){
    if(!drawer) return;
    drawer.setAttribute('aria-hidden','false');
    document.body.classList.add('settings-open');
  }
  function closeDrawer(){
    if(!drawer) return;
    drawer.setAttribute('aria-hidden','true');
    document.body.classList.remove('settings-open');
  }

  if(openBtn) openBtn.addEventListener('click', (e)=>{ e.preventDefault(); openDrawer(); });
  if(closeBtn) closeBtn.addEventListener('click', (e)=>{ e.preventDefault(); closeDrawer(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeDrawer(); });

  // ===== Supabase client =====
  const SUPABASE_URL = "https://inuqlhkoaoeiycefvjyj.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImludXFsaGtvYW9laXljZWZ2anlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMTUxODEsImV4cCI6MjA3ODY5MTE4MX0.DCAY9rN0noaBoE_T-6eDsb_79szK91af989f9TqjEow";
  if(!window.supabase) return;
  const sb = window.__sbClient || window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.__sbClient = sb;

  // ===== Elements =====
  const adminEmail = document.getElementById('adminEmail');
  const adminPass  = document.getElementById('adminPass');
  const signInBtn  = document.getElementById('adminSignInBtn');
  const signOutBtn = document.getElementById('adminSignOutBtn');
  const whoEl      = document.getElementById('adminWho');

  const signedOutBox = document.getElementById('adminSessionSignedOut');
  const signedInBox  = document.getElementById('adminSessionSignedIn');
  const authStatus1  = document.getElementById('adminAuthStatus');
  const authStatus2  = document.getElementById('adminAuthStatus2');

  const empEl  = document.getElementById('permEmployeeId');
  const sEl    = document.getElementById('permSettings');
  const aEl    = document.getElementById('permAI');
  const dEl    = document.getElementById('permDashboard');
  const loadBtn= document.getElementById('permLoadBtn');
  const saveBtn= document.getElementById('permSaveBtn');
  const permStatus = document.getElementById('permStatus');

  const searchEl = document.getElementById('permSearch');
  const refreshBtn = document.getElementById('permRefreshBtn');
  const tableBody = document.getElementById('permTableBody');
  const listStatus = document.getElementById('permListStatus');

  function setMsg(el, msg, ok){
    if(!el) return;
    el.textContent = msg || "";
    el.style.color = ok ? "#22c55e" : "#ef4444";
  }

  async function isAdmin(){
    const { data, error } = await sb.rpc('is_admin');
    if(error) return false;
    return data === true;
  }

  async function syncAdminUI(){
    const { data: { session } } = await sb.auth.getSession();
    if(!session){
      signedInBox.style.display = 'none';
      signedOutBox.style.display = '';
      setMsg(authStatus2, "", true);
      return false;
    }
    const ok = await isAdmin();
    if(!ok){
      // signed in but not admin
      signedInBox.style.display = 'none';
      signedOutBox.style.display = '';
      setMsg(authStatus1, "Signed in but not authorized as admin.", false);
      return false;
    }
    signedOutBox.style.display = 'none';
    signedInBox.style.display = '';
    whoEl.textContent = session.user.email || session.user.id;
    setMsg(authStatus2, "Admin session active âœ…", true);
    setMsg(authStatus1, "", true);
    return true;
  }

  async function signInAdmin(){
    setMsg(authStatus1, "Signing in...", true);
    const email = (adminEmail.value||"").trim();
    const pass  = (adminPass.value||"").trim();
    const { error } = await sb.auth.signInWithPassword({ email, password: pass });
    if(error){
      setMsg(authStatus1, "Sign in failed. Check email/password.", false);
      return;
    }
    setMsg(authStatus1, "", true);
    await syncAdminUI();
    await refreshList();
  }

  async function signOutAdmin(){
    await sb.auth.signOut();
    await syncAdminUI();
    setMsg(listStatus, "", true);
    if(tableBody) tableBody.innerHTML = "";
  }

  if(signInBtn) signInBtn.addEventListener('click', (e)=>{ e.preventDefault(); signInAdmin(); });
  if(signOutBtn) signOutBtn.addEventListener('click', (e)=>{ e.preventDefault(); signOutAdmin(); });

  // ===== Permissions helpers =====
  function readEmployeeId(){
    const v = (empEl.value||"").trim();
    if(!v) return null;
    if(!/^[0-9]+$/.test(v)) return null;
    return Number(v);
  }

  async function loadOne(){
    const ok = await syncAdminUI();
    if(!ok) { setMsg(permStatus, "Admin sign-in required.", false); return; }

    const emp = readEmployeeId();
    if(emp === null) { setMsg(permStatus, "Enter a valid Employee ID.", false); return; }
    setMsg(permStatus, "Loading...", true);

    const { data, error } = await sb.rpc('admin_get_permissions_by_employee', { p_employee_id: emp });
    if(error){ setMsg(permStatus, "Load failed. Make sure the employee exists and is linked.", false); return; }

    sEl.checked = !!data.settings;
    aEl.checked = !!data.ai;
    dEl.checked = !!data.dashboard;
    setMsg(permStatus, "Loaded âœ…", true);
  }

  async function saveOne(){
    const ok = await syncAdminUI();
    if(!ok) { setMsg(permStatus, "Admin sign-in required.", false); return; }

    const emp = readEmployeeId();
    if(emp === null) { setMsg(permStatus, "Enter a valid Employee ID.", false); return; }

    saveBtn.disabled = true;
    setMsg(permStatus, "Saving...", true);
    try {
      await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'settings',  p_can_access: !!sEl.checked });
      await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'ai',        p_can_access: !!aEl.checked });
      await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'dashboard', p_can_access: !!dEl.checked });
      setMsg(permStatus, "Saved âœ…", true);
      await refreshList();
    } catch(e) {
      console.error(e);
      setMsg(permStatus, "Save failed.", false);
    } finally {
      saveBtn.disabled = false;
    }
  }

  if(loadBtn) loadBtn.addEventListener('click', (e)=>{ e.preventDefault(); loadOne(); });
  if(saveBtn) saveBtn.addEventListener('click', (e)=>{ e.preventDefault(); saveOne(); });

  // ===== List & edit =====
  function rowHtml(r){
    const emp = r.employee_id ?? "";
    const email = r.email ?? "";
    const s = r.settings ? "checked" : "";
    const a = r.ai ? "checked" : "";
    const d = r.dashboard ? "checked" : "";
    return `
      <tr data-emp="${emp}">
        <td style="padding:10px;">${emp}</td>
        <td style="padding:10px; word-break:break-word;">${email}</td>
        <td style="padding:10px; text-align:center;"><input class="tblS" type="checkbox" ${s}></td>
        <td style="padding:10px; text-align:center;"><input class="tblA" type="checkbox" ${a}></td>
        <td style="padding:10px; text-align:center;"><input class="tblD" type="checkbox" ${d}></td>
        <td style="padding:10px; text-align:right;">
          <button class="btn tblSave" type="button">Update</button>
          <button class="btn tblRevoke" type="button" style="margin-left:8px;">Revoke</button>
        </td>
      </tr>`;
  }

  async function refreshList(){
    const ok = await syncAdminUI();
    if(!ok){ setMsg(listStatus, "Admin sign-in required to view the list.", false); return; }

    setMsg(listStatus, "Loading list...", true);
    const { data, error } = await sb.rpc('admin_list_permissions');
    if(error){ console.error(error); setMsg(listStatus, "Failed to load list.", false); return; }

    const q = (searchEl.value||"").trim().toLowerCase();
    const rows = (data||[]).filter(r => {
      if(!q) return true;
      return String(r.email||"").toLowerCase().includes(q) || String(r.employee_id||"").toLowerCase().includes(q);
    });

    tableBody.innerHTML = rows.map(rowHtml).join("");
    setMsg(listStatus, `Loaded ${rows.length} users âœ…`, true);
  }

  if(refreshBtn) refreshBtn.addEventListener('click', (e)=>{ e.preventDefault(); refreshList(); });
  if(searchEl) searchEl.addEventListener('input', ()=>{ refreshList(); });

  // delegate table actions
  if(tableBody){
    tableBody.addEventListener('click', async (e)=>{
      const tr = e.target.closest('tr');
      if(!tr) return;
      const emp = Number(tr.getAttribute('data-emp'));
      if(!emp) return;

      if(e.target.classList.contains('tblSave')){
        const s = tr.querySelector('.tblS').checked;
        const a = tr.querySelector('.tblA').checked;
        const d = tr.querySelector('.tblD').checked;
        setMsg(listStatus, "Updating...", true);
        try {
          await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'settings',  p_can_access: !!s });
          await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'ai',        p_can_access: !!a });
          await sb.rpc('admin_set_page_access_by_employee', { p_employee_id: emp, p_page_key: 'dashboard', p_can_access: !!d });
          setMsg(listStatus, "Updated âœ…", true);
        } catch(err) {
          console.error(err);
          setMsg(listStatus, "Update failed.", false);
        }
      }

      if(e.target.classList.contains('tblRevoke')){
        setMsg(listStatus, "Revoking...", true);
        try {
          await sb.rpc('admin_revoke_all_by_employee', { p_employee_id: emp });
          await refreshList();
          setMsg(listStatus, "Revoked âœ…", true);
        } catch(err) {
          console.error(err);
          setMsg(listStatus, "Revoke failed.", false);
        }
      }
    });
  }

  // init
  sb.auth.onAuthStateChange(async ()=>{
    await syncAdminUI();
  });
  syncAdminUI();
})();
</script>

</body>
</html>
